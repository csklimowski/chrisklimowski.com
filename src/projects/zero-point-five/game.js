"use strict";var _createClass=function(){function a(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var game=function(){var d=[{start:{x:100,y:300},exit:{x:500,y:325},walls:[{x:0,y:0},{x:0,y:350},{x:200,y:350},{x:200,y:300},{x:400,y:300},{x:400,y:350},{x:600,y:350},{x:600,y:0}],rectangles:[]},{start:{x:100,y:300},walls:[{x:0,y:0},{x:0,y:350},{x:600,y:350},{x:600,y:0}],rectangles:[{x:275,y:100,width:75,height:150,kills:!0,motion:{keyframes:[{x:275,y:200,duration:.5},{x:275,y:100,duration:2}]}}],exit:{x:500,y:325}},{start:{x:100,y:250},walls:[{x:0,y:0},{x:0,y:300},{x:250,y:300},{x:250,y:400},{x:350,y:400},{x:350,y:300},{x:600,y:300},{x:600,y:0}],rectangles:[{x:250,y:400,width:100,height:250,collides:!0,motion:{keyframes:[{x:250,y:150,duration:4},{x:250,y:400,duration:4}]}}],exit:{x:300,y:100}},{start:{x:75,y:275},walls:[{x:0,y:0},{x:0,y:325},{x:150,y:325},{x:150,y:400},{x:210,y:400},{x:210,y:325},{x:350,y:325},{x:350,y:400},{x:410,y:400},{x:410,y:325},{x:600,y:325},{x:600,y:0}],rectangles:[{x:150,y:340,width:60,height:60,kills:!0},{x:350,y:340,width:60,height:60,kills:!0}],exit:{x:525,y:300}},{start:{x:300,y:125},walls:[{x:0,y:0},{x:0,y:325},{x:600,y:325},{x:600,y:0}],rectangles:[{x:150,y:175,width:300,height:50,collides:!0}],exit:{x:300,y:275}},{start:{x:100,y:150},walls:[{x:0,y:0},{x:0,y:200},{x:200,y:200},{x:200,y:250},{x:0,y:250},{x:0,y:500},{x:400,y:500},{x:400,y:350},{x:600,y:350},{x:600,y:250},{x:500,y:250},{x:500,y:200},{x:600,y:200},{x:600,y:0}],rectangles:[{x:0,y:350,width:400,height:50,kills:!0},{x:260,y:200,width:180,height:50,collides:!0}],exit:{x:475,y:300}},{start:{x:75,y:150},exit:{x:475,y:325},walls:[{x:0,y:0},{x:0,y:200},{x:150,y:200},{x:150,y:500},{x:550,y:500},{x:550,y:200},{x:600,y:200},{x:600,y:0}],rectangles:[{x:150,y:200,width:400,height:50,collides:!0,toggledBy:"right"},{x:150,y:450,width:400,height:50,kills:!0}]},{start:{x:200,y:300},walls:[{x:0,y:0},{x:0,y:300},{x:100,y:300},{x:100,y:350},{x:500,y:350},{x:500,y:300},{x:600,y:300},{x:600,y:0}],rectangles:[{x:100,y:295,width:400,height:55,collides:!0,toggledBy:"up"},{x:0,y:170,width:600,height:50,kills:!0,toggledBy:"right"}],exit:{x:550,y:275}},{start:{x:300,y:25},walls:[{x:100,y:0},{x:100,y:350},{x:500,y:350},{x:500,y:0}],rectangles:[{x:100,y:75,width:400,height:50,collides:!0,toggledBy:"left"},{x:100,y:175,width:400,height:50,collides:!0,toggledBy:"right"},{x:100,y:125,width:150,height:50,kills:!0,motion:{keyframes:[{x:350,y:125,duration:1.5},{x:100,y:125,duration:1.5}]}},{x:350,y:225,width:150,height:50,kills:!0,motion:{keyframes:[{x:100,y:225,duration:1.5},{x:350,y:225,duration:1.5}]}}],exit:{x:450,y:315}},{start:{x:150,y:250},walls:[{x:0,y:0},{x:0,y:150},{x:350,y:150},{x:350,y:200},{x:0,y:200},{x:0,y:300},{x:350,y:300},{x:350,y:500},{x:600,y:500},{x:600,y:0}],rectangles:[{x:350,y:150,width:150,height:50,collides:!0,toggledBy:"right",motion:{keyframes:[{x:350,y:300,duration:1},{x:350,y:300,duration:1},{x:350,y:150,duration:1},{x:350,y:150,duration:1}]}}],exit:{x:150,y:125}}],t=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,Phaser.State),_createClass(i,[{key:"create",value:function(){A.stage.backgroundColor=0,this.graphics=A.add.graphics(0,0);var t=d[A.levelNumber];A.world.setBounds(0,0,600,400),this.walls=[];for(var i=0;i<t.walls.length;i++)this.walls.push({x1:t.walls[i].x,y1:t.walls[i].y,x2:t.walls[(i+1)%t.walls.length].x,y2:t.walls[(i+1)%t.walls.length].y});var e=!0,a=!(this.rectangles=[]),s=void 0;try{for(var r,h=t.rectangles[Symbol.iterator]();!(e=(r=h.next()).done);e=!0){var o=r.value,n={x:o.x,y:o.y,width:o.width,height:o.height,collides:o.collides,kills:o.kills,vx:0,vy:0};o.motion&&(n.motion={keyframes:o.motion.keyframes,keyframe:0,x0:o.x,y0:o.y,xf:o.motion.keyframes[0].x,yf:o.motion.keyframes[0].y,t:0,tf:o.motion.keyframes[0].duration}),o.toggledBy&&(n.toggledBy=o.toggledBy,n.arrow=A.add.image(n.x,n.y,"small-arrows"),"left"===o.toggledBy&&(n.arrow.frame=0),"up"===o.toggledBy&&(n.arrow.frame=1),"right"===o.toggledBy&&(n.arrow.frame=2)),this.rectangles.push(n)}}catch(t){a=!0,s=t}finally{try{!e&&h.return&&h.return()}finally{if(a)throw s}}this.player={x:t.start.x,y:t.start.y,width:50,height:50,vx:0,vy:0,tvx:0,tvy:0,onFloor:!1,onLeftWall:!1,onRightWall:!1,onCeiling:!1},this.death=A.add.sprite(0,0,"death",17),this.death.anchor.set(.5),this.death.animations.add("death",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],45,!1),this.exit=A.add.sprite(t.exit.x,t.exit.y,"exit"),this.exit.anchor.set(.5),this.exit.animations.add("exit",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],35,!1),this.exit.rectangle={x:this.exit.x-20,y:this.exit.y-20,width:40,height:40,isExit:!0},A.input.reset(!0);var l=A.input.keyboard.addKeys({w:Phaser.KeyCode.W,a:Phaser.KeyCode.A,d:Phaser.KeyCode.D,left:Phaser.KeyCode.LEFT,up:Phaser.KeyCode.UP,right:Phaser.KeyCode.RIGHT});l.w.onDown.add(this.onJumpDown,this),l.up.onDown.add(this.onJumpDown,this),l.w.onUp.add(this.onJumpUp,this),l.up.onUp.add(this.onJumpUp,this),l.a.onDown.add(this.onLeftDown,this),l.a.onUp.add(this.onLeftUp,this),l.left.onDown.add(this.onLeftDown,this),l.left.onUp.add(this.onLeftUp,this),l.d.onDown.add(this.onRightDown,this),l.d.onUp.add(this.onRightUp,this),l.right.onDown.add(this.onRightDown,this),l.right.onUp.add(this.onRightUp,this),this.keySprites={left:A.add.image(20,20,"arrows",2),up:A.add.image(90,20,"arrows",0),right:A.add.image(160,20,"arrows",4)},this.leftDown=l.left.isDown,this.rightDown=l.right.isDown,this.jumpDown=l.up.isDown,this.leftsLeft=1,this.rightsLeft=1,this.jumpsLeft=1,this.started=!1,this.finished=!1;var y=A.add.sprite(A.width/2,A.height/2,"numbies");y.anchor.set(.5),y.anchor.set(.5),y.animations.add("countdown",[0,1,2],1.5,!1),y.events.onAnimationComplete.add(function(){this.started=!0,this.countdown.frame=3},this),y.animations.play("countdown"),this.countdown=y,this.curtain=A.add.image(-100,0,"curtain"),this.curtainRising=!0}},{key:"onLeftDown",value:function(){this.keySprites.left.frame=3,this.leftDown=!0,this.started&&!this.finished&&(this.leftsLeft--,0===this.leftsLeft&&(this.keySprites.left.alpha=.5),this.leftsLeft<0&&(this.keySprites.left.alpha=0))}},{key:"onLeftUp",value:function(){this.keySprites.left.frame=2,this.leftDown=!1,this.started&&!this.finished&&(this.leftsLeft--,0===this.leftsLeft&&(this.keySprites.left.alpha=.5),this.leftsLeft<0&&(this.keySprites.left.alpha=0))}},{key:"onRightDown",value:function(){this.keySprites.right.frame=5,this.rightDown=!0,this.started&&!this.finished&&(this.rightsLeft--,0===this.rightsLeft&&(this.keySprites.right.alpha=.5),this.rightsLeft<0&&(this.keySprites.right.alpha=0))}},{key:"onRightUp",value:function(){this.keySprites.right.frame=4,this.rightDown=!1,this.started&&!this.finished&&(this.rightsLeft--,0===this.rightsLeft&&(this.keySprites.right.alpha=.5),this.rightsLeft<0&&(this.keySprites.right.alpha=0))}},{key:"onJumpUp",value:function(){this.keySprites.up.frame=0,this.jumpDown=!1,this.started&&!this.finished&&(this.jumpsLeft--,0===this.jumpsLeft&&(this.keySprites.up.alpha=.5),this.jumpsLeft<0&&(this.keySprites.up.alpha=0))}},{key:"onJumpDown",value:function(){this.keySprites.up.frame=1,this.jumpDown=!0,this.started&&!this.finished&&(this.jumpsLeft--,0===this.jumpsLeft&&(this.keySprites.up.alpha=.5),this.jumpsLeft<0&&(this.keySprites.up.alpha=0),this.player.onFloor&&(this.player.vy=-500,this.player.onFloor=!1))}},{key:"playerDies",value:function(){this.player.dead||this.finished||(this.player.dead=!0,this.death.x=this.player.x,this.death.y=this.player.y,this.death.animations.play("death"),A.lastFinished=!1,this.curtain.x=600)}},{key:"update",value:function(){var t=this.player,i=A.time.elapsedMS/1e3;this.exit.rotation+=i,(this.leftsLeft<0||this.rightsLeft<0||this.jumpsLeft<0)&&this.playerDies();var e=!0,a=!1,s=void 0;try{for(var r,h=this.rectangles[Symbol.iterator]();!(e=(r=h.next()).done);e=!0){var o=r.value;o.toggledBy&&(o.active="left"===o.toggledBy&&this.leftDown||"up"===o.toggledBy&&this.jumpDown||"right"===o.toggledBy&&this.rightDown)}}catch(t){a=!0,s=t}finally{try{!e&&h.return&&h.return()}finally{if(a)throw s}}if(this.started){this.leftDown&&this.rightDown?t.tvx=0:this.leftDown?t.tvx=-200:this.rightDown?t.tvx=200:t.tvx=0,this.finished?(t.height+=10*-t.height*i,t.width+=10*-t.width*i):this.jumpDown?(t.height+=20*(70-t.height)*i,t.width+=20*(70-t.width)*i):(t.height+=10*(50-t.height)*i,t.width+=10*(50-t.width)*i),t.onFloor?0===t.tvx?t.vx+=10*(t.tvx-t.vx)*i:t.vx+=5*(t.tvx-t.vx)*i:(t.vx+=3*(t.tvx-t.vx)*i,t.vy+=1500*i),this.finished||t.dead||(t.x+=t.vx*i,t.y+=t.vy*i);var n=!(t.onFloor=!1),l=!1,y=void 0;try{for(var d,x=this.rectangles[Symbol.iterator]();!(n=(d=x.next()).done);n=!0){var u=d.value;if(u.motion){var g=u.x,f=u.y;if(u.motion.t=Math.min(u.motion.tf,u.motion.t+i),u.x=u.motion.x0+u.motion.t/u.motion.tf*(u.motion.xf-u.motion.x0),u.y=u.motion.y0+u.motion.t/u.motion.tf*(u.motion.yf-u.motion.y0),u.motion.t===u.motion.tf){u.motion.x0=u.x,u.motion.y0=u.y,u.motion.t=0,u.motion.keyframe=(u.motion.keyframe+1)%u.motion.keyframes.length;var c=u.motion.keyframes[u.motion.keyframe];u.motion.xf=c.x,u.motion.yf=c.y,u.motion.tf=c.duration}u.vx=u.x-g,u.vy=u.y-f,u.toggledBy&&(u.arrow.x=u.x,u.arrow.y=u.y)}}}catch(t){l=!0,y=t}finally{try{!n&&x.return&&x.return()}finally{if(l)throw y}}if(!this.finished){t.x-=t.width/2,t.y-=t.height/2;var p=!0,m=!1,w=void 0;try{for(var v,k=this.walls[Symbol.iterator]();!(p=(v=k.next()).done);p=!0){var b=v.value;this.hitWall(t,b,i)}}catch(t){m=!0,w=t}finally{try{!p&&k.return&&k.return()}finally{if(m)throw w}}var _=!0,C=!1,D=void 0;try{for(var S,L=this.rectangles[Symbol.iterator]();!(_=(S=L.next()).done);_=!0){var R=S.value;R.toggledBy&&!R.active||this.hitRectangle(t,R,i)}}catch(t){C=!0,D=t}finally{try{!_&&L.return&&L.return()}finally{if(C)throw D}}this.hitRectangle(t,this.exit.rectangle,i),t.x+=t.width/2,t.y+=t.height/2}}var j=this.graphics;if(j.clear(),j.lineStyle(0),3<=this.walls.length){this.started?j.beginFill(2263210):j.beginFill(17527),j.moveTo(this.walls[0].x1,this.walls[0].y1);var P=!0,B=!1,F=void 0;try{for(var M,O=this.walls[Symbol.iterator]();!(P=(M=O.next()).done);P=!0){var U=M.value;j.lineTo(U.x1,U.y1),j.lineTo(U.x2,U.y2)}}catch(t){B=!0,F=t}finally{try{!P&&O.return&&O.return()}finally{if(B)throw F}}j.endFill()}var q=!0,T=!1,K=void 0;try{for(var W,E=this.rectangles[Symbol.iterator]();!(q=(W=E.next()).done);q=!0){var J=W.value,N=1;N=J.toggledBy&&!J.active?.3:1,J.collides&&j.beginFill(0,N),J.kills&&j.beginFill(6684672,N),j.drawRect(J.x,J.y,J.width,J.height)}}catch(t){T=!0,K=t}finally{try{!q&&E.return&&E.return()}finally{if(T)throw K}}this.player.dead||(j.beginFill(16777215),j.drawRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height)),this.curtainRising?A.lastFinished?(this.curtain.x+=1e3*i,600<this.curtain.x&&(this.curtainRising=!1)):(this.curtain.x-=1e3*i,this.curtain.x<-700&&(this.curtainRising=!1)):this.finished?(this.curtain.x+=1e3*i,-100<this.curtain.x&&(9<A.levelNumber?A.state.start("end"):A.state.start("main"))):this.player.dead&&(this.curtain.x-=1e3*i,this.curtain.x<0&&A.state.start("main"))}},{key:"hitRectangle",value:function(t,i,e){if(!(t.x+t.width<i.x||t.y+t.height<i.y||t.x>i.x+i.width||t.y>i.y+i.height)){if(i.collides){var a=t.vy*e,s=t.vx*e;if(0<a&&Math.floor(t.y-a+t.height)<=Math.ceil(i.y-i.vy))return t.y=i.y-t.height,void(t.onFloor=!0);if(a<0&&Math.ceil(t.y-a)>=Math.floor(i.y+i.height-i.vy))return t.y=i.y+i.height,t.vy=0,void(t.onCeiling=!0);if(0<s&&Math.floor(t.x-s+t.width)<=Math.ceil(i.x-i.vx))return t.x=i.x-t.width,t.vx=0,void(t.onRightWall=!0);if(s<0&&Math.ceil(t.x)-s>=Math.floor(i.x+i.width-i.vx))return t.x=i.x+i.width,t.vx=0,void(t.onLeftWall=!0)}i.kills&&(t.x+=t.width/2,t.y+=t.height/2,this.playerDies()),i.isExit&&(this.finished=!0,A.lastFinished=!0,A.levelNumber++,this.curtain.x=-700,this.exit.animations.play("exit"))}}},{key:"hitWall",value:function(t,i,e){var a=t.vx*e,s=t.vy*e;if(i.y1==i.y2&&i.x1<i.x2==0<s){if(i.y1>t.y&&i.y1<t.y+t.height&&t.x+t.width>Math.min(i.x1,i.x2)&&t.x<Math.max(i.x1,i.x2)&&(0<s&&Math.floor(t.y-s+t.height)<=i.y1&&(t.y=i.y1-t.height,t.onFloor=!0),s<0&&Math.ceil(t.y-s)>=i.y1))return t.y=i.y1,void(t.vy=0)}else if(i.x1==i.x2&&i.y1>i.y2==0<a&&i.x1>t.x&&i.x1<t.x+t.width&&t.y+t.height>Math.min(i.y1,i.y2)&&t.y<Math.max(i.y1,i.y2)){if(0<a&&Math.floor(t.x-a+t.width)<=i.x1)return t.x=i.x1-t.width,void(t.vx=0);if(a<0&&Math.ceil(t.x)-a>=i.x1)return t.x=i.x1,void(t.vx=0)}}}]),i}(),i=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,Phaser.State),_createClass(i,[{key:"preload",value:function(){A.load.spritesheet("arrows","img/arrows.png",70,70),A.load.spritesheet("numbies","img/numbies.png",120,120),A.load.spritesheet("death","img/death.png",100,100),A.load.spritesheet("exit","img/exit.png",80,80),A.load.spritesheet("mouse","img/mouse.png",70,70),A.load.spritesheet("small-arrows","img/small-arrows.png",50,50),A.load.image("curtain","img/curtain.png"),A.load.image("quote-1","img/quote-1.png"),A.load.image("quote-2","img/quote-2.png"),A.load.image("quote-3","img/quote-3.png"),A.load.image("tutorial-1","img/tutorial-1.png"),A.load.image("tutorial-2","img/tutorial-2.png"),A.load.image("tutorial-3","img/tutorial-3.png"),A.load.image("thanks-for-playing","img/thanks-for-playing.png")}},{key:"create",value:function(){A.levelNumber=0,A.lastFinished=!0,A.state.start("intro")}}]),i}(),e=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,Phaser.State),_createClass(i,[{key:"create",value:function(){var t=A.add.image(100,100,"quote-1"),i=A.add.image(100,150,"quote-2"),e=A.add.image(220,250,"quote-3"),a=A.add.image(0,0,"curtain");t.alpha=0,i.alpha=0,e.alpha=0,a.alpha=0;var s=A.add.tween(t).to({alpha:1},2e3),r=A.add.tween(i).to({alpha:1},2e3),h=A.add.tween(e).to({alpha:1},2e3),o=A.add.tween(a).to({alpha:1},500);s.chain(r),r.chain(h),h.chain(o),o.onComplete.add(function(){A.state.start("tutorial")}),s.start()}}]),i}(),a=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,Phaser.State),_createClass(i,[{key:"create",value:function(){A.stage.backgroundColor=2263210,A.world.setBounds(0,0,1800,400),A.add.image(0,0,"tutorial-1"),A.add.image(600,0,"tutorial-2"),A.add.image(1200,0,"tutorial-3"),this.mouse=A.add.sprite(550,350,"mouse"),this.exit=A.add.sprite(1130,145,"exit"),this.exit.anchor.set(.5),this.mouse.anchor.set(.5),this.mouse.animations.add("blink",[0,1],1.5,!0),this.mouse.animations.play("blink"),this.curtain=A.add.image(-100,0,"curtain"),this.curtainFalling=!1,A.input.activePointer.leftButton.onDown.add(this.onClick,this),this.tcx=0,this.clickCount=0}},{key:"onClick",value:function(){this.tcx+=600,this.clickCount++,2<this.clickCount&&(this.curtain.x=500,this.curtainFalling=!0)}},{key:"update",value:function(){var t=A.time.elapsedMS/1e3;A.camera.x+=Math.ceil(5*(this.tcx-A.camera.x)*t),this.exit.rotation+=t,this.curtain.x+=1500*t,this.curtainFalling&&1100<=this.curtain.x&&A.state.start("main")}}]),i}(),s=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,Phaser.State),_createClass(i,[{key:"create",value:function(){A.stage.backgroundColor=2263210,A.add.image(0,0,"thanks-for-playing"),this.curtain=A.add.image(-100,0,"curtain")}},{key:"update",value:function(){var t=A.time.elapsedMS/1e3;this.curtain.x+=1500*t}}]),i}(),A=new Phaser.Game(600,400,Phaser.AUTO,"game");return A.state.add("main",t),A.state.add("load",i),A.state.add("intro",e),A.state.add("tutorial",a),A.state.add("end",s),A.state.start("load"),A}();