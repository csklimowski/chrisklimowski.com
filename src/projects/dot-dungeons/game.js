"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),game=function(){function e(e){return 150+100*e}function t(e){return 100+100*e}function a(a){var n=[];n.remaining=0;for(var i=a.layout,o=0;o<i.length;o++){for(var r=[],s=0;s<i[o].length;s++){var l=i[o][s];if(" "===l)r.push(null);else{var u=new v(e(s),t(o),l);(u.hasNumber||u.hasInfo)&&n.remaining++,u.hasInfo&&(u.info=a.info[l]),r.push(u)}"N"!==l&&"n"!==l||(n.startX=s,n.startY=o,"n"===l&&n.remaining--),"X"===l&&(n.endX=s,n.endY=o)}n.push(r)}return n}function n(e){var t=Math.min(23,13+.5*e),a=Math.min(25,15+.5*e),n=Math.min(23,3+e),i=Math.min(25,5+e),o=void 0,r=void 0,s=0;do{s++,r=!1,o=[Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" ")];var l=1+Math.floor(7*Math.random()),u=1+Math.floor(5*Math.random()),h=[],d=0,c=0,m=0;for(o[u][l]="N";;){h.push({x:l,y:u});for(var p=[],y=-1;y<2;y++)for(var g=-1;g<2;g++)if((0!==y||0!==g)&&l+y>0&&u+g>0&&l+y<8&&u+g<6){for(var f=!0,v=0;v<h.length-1;v++){if(h[v].x===l&&h[v].y===u&&h[v+1].x===l+y&&h[v+1].y===u+g){f=!1;break}if(h[v].x===l+y&&h[v].y===u+g&&h[v+1].x===l&&h[v+1].y===u){f=!1;break}}f&&p.push({x:y,y:g})}if(0===p.length){r=!0;break}var b=p[Math.floor(Math.random()*p.length)];if(l+=b.x,u+=b.y," "===o[u][l]){if(m>=n&&d>=t){o[u][l]="X";break}if(c<4?(o[u][l]=""+c,m+=c,3===c&&m++):o[u][l]="0",++d>a||m>i){r=!0;break}c=0}else c++}}while(r);return console.log("It took "+s+" attempts to generate this level."),{layout:o}}var i={"1-1":{x:1440,y:270,layout:["           ","   00000   ","   00000   ","  N00100X  ","   00000   ","   00000   ","           "],unlocks:["1-2"]},"1-2":{x:1700,y:270,layout:["          ","          ","   0000   ","  N0110X  ","   0000   ","          ","          "],unlocks:["1-3"]},"1-3":{x:1950,y:340,layout:["           ","           ","  N01110X  ","   00000   ","           ","           "],unlocks:["1-4"]},"1-4":{x:2050,y:500,layout:["           ","           ","    101    ","   N000X   ","    101    ","           ","           "],unlocks:["1-5"]},"1-5":{x:2330,y:550,layout:["          ","    00    ","    01    ","    01    ","    01    ","   N01X   ","          "],unlocks:["X-1","2-1"]}},o={"X-1":{x:2330,y:890,layout:["           ","   10101   ","   01110   ","  N11111X  ","   01110   ","   10101   ","           "],unlocks:["X-2"]},"X-2":{x:2050,y:940,layout:["          ","          ","   0111   ","  N0111X  ","   0111   ","          ","          "],unlocks:["X-3"]},"X-3":{x:1950,y:1100,layout:["           ","           ","  N11111X  ","   00000   ","           ","           "],unlocks:["X-4"]},"X-4":{x:1700,y:1170,layout:["           ","           ","    111    ","   N001X   ","    111    ","           ","           "],unlocks:["X-5"]},"X-5":{x:1440,y:1170,layout:["          ","    01    ","    01    ","    01    ","    01    ","   N01X   ","          "],unlocks:[]}},r={"2-1":{x:2670,y:540,layout:["          ","          ","    00    ","  N0002X  ","    00    ","          ","          "],unlocks:["2-2"]},"2-2":{x:2930,y:500,layout:["          ","    00X   ","    02    ","    01    ","   N00    ","          "],unlocks:["2-3"]},"2-3":{x:3100,y:320,layout:["           ","     2     ","    010    ","   N000X   ","    010    ","     2     ","           "],unlocks:["2-4"]},"2-4":{x:3370,y:300,layout:["           ","    N X    ","   00000   ","   00 00   ","   02020   ","           "],unlocks:["2-5"]},"2-5":{x:3610,y:430,layout:["           ","    202    ","    000    ","   N000X   ","    000    ","    202    ","           "],unlocks:["Y-1","3-1"]}},s={"Y-1":{x:3610,y:1010,layout:["          ","          ","    00    ","  N0220X  ","    00    ","          ","          "],unlocks:["Y-2"]},"Y-2":{x:3370,y:1140,layout:["          ","    00X   ","    22    ","    11    ","   N00    ","          "],unlocks:["Y-3"]},"Y-3":{x:3100,y:1120,layout:["           ","     2     ","    010    ","   N121X   ","    010    ","     2     ","           "],unlocks:["Y-4"]},"Y-4":{x:2930,y:940,layout:["           ","    N X    ","   02020   ","   00 00   ","   02020   ","           "],unlocks:["Y-5"]},"Y-5":{x:2670,y:900,layout:["           ","    202   ","    000   ","   N000X   ","    000    ","    222  ","           "],unlocks:[]}},l={"3-1":{x:3960,y:430,layout:["           ","           ","    000    ","   N030X   ","    000    ","           ","           "],unlocks:["3-2"]},"3-2":{x:4185,y:290,layout:["          ","   N03X   ","    02    ","    01    ","    00    ","    00    ","          "],unlocks:["3-3"]},"3-3":{x:4510,y:265,layout:["          ","          ","   0030   ","  N0000X  ","   0300   ","          ","          "],unlocks:["3-4"]},"3-4":{x:4765,y:385,layout:["           ","   00300   ","   01010   ","  N00 00X  ","   01010   ","   00300   ","           "],unlocks:["3-5"]},"3-5":{x:4850,y:585,layout:["           ","           ","   10203   ","  N00000X  ","   10203   ","           ","           "],unlocks:["Z-1"]}},u={"Z-1":{x:4850,y:855,layout:["           ","           ","    030    ","   N000X   ","    030    ","           ","           "],unlocks:["Z-2"]},"Z-2":{x:4765,y:1055,layout:["          ","   N03X   ","    02    ","    01    ","    02    ","    03    ","          "],unlocks:["Z-3"]},"Z-3":{x:4510,y:1175,layout:["          ","          ","   3003   ","  N0000X  ","   3003   ","          ","          "],unlocks:["Z-4"]},"Z-4":{x:4185,y:1150,layout:["           ","   00100   ","   03030   ","  N00 00X  ","   03030   ","   00100   ","           "],unlocks:["Z-5"]},"Z-5":{x:3960,y:1010,layout:["           ","           ","   30201   ","  N00000X  ","   30201   ","           ","           "],unlocks:[]}},h=[{layout:["           ","    0a00b  ","  n0000    ","    0000X  ","           ","           "],info:{n:"CLICK to move!",a:"You can't retrace your own path, but you can\nrevisit dots you've been to before.",b:"If you ever get stuck, you can press           to go\nback one step."}},{layout:["           ","   000  X  ","   0 0 000 "," N000a 000 ","   0   000 ","   b0000c0 ","           "],info:{a:"Revisiting dots that you've been to before builds\nup CHARGE.",b:"But if you visit a dot for the first time, your\ncharge goes away.",c:"So, to build up a charge of more than 1, you need\nto revisit multiple dots in a row."}},{layout:["           "," Na0b0     ","   00000   ","   00010X  ","   00000   ","           "],info:{a:"In each room, you need to CAPTURE all of the\nnumbers, then get to the exit.",b:"To capture a number, first build up a charge\nequal to it, then touch it."}}],d=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,C.width/2,0,"transition"));return C.stage.addChild(e),e.anchor.set(.5,0),e.falling=!1,e.newState="menu",e}return _inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){this.falling?(this.y=Math.min(0,this.y+2*C.time.elapsedMS),this.y>=0&&(C.state.start(this.newState),this.falling=!1)):this.y+=2*C.time.elapsedMS}},{key:"raise",value:function(){this.y=C.height,this.angle=180}},{key:"transition",value:function(e){this.newState=e,this.falling=!0,this.y=-1e3,this.angle=0}}]),t}(),c=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,100,C.height,"info-box"));return C.stage.addChild(e),e.text=C.make.bitmapText(e.x+40,e.y+30,"handwriting","",70),C.stage.addChild(e.text),e.targetY=e.y,e.undoIcon=C.make.image(850,0,"undo"),C.stage.addChild(e.undoIcon),e}return _inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){var e=C.time.elapsedMS/1e3;this.y+=10*(this.targetY-this.y)*e,this.text.y=this.y+30,this.undoIcon.y=this.y+32}},{key:"appear",value:function(e){-1!==e.indexOf("    ")?this.undoIcon.alpha=1:this.undoIcon.alpha=0,this.text.text=e,this.targetY=450}},{key:"dismiss",value:function(){this.targetY=C.height}}]),t}(),m=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Phaser.State),_createClass(t,[{key:"preload",value:function(){C.add.text(C.width/2,C.height/2,"Loading...",{font:"30px sans-serif",fill:"#ffffff",align:"center"}).anchor.set(.5),C.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,C.scale.windowConstraints.bottom="layout",C.load.spritesheet("level-button","img/menu/level-button.png",70,70),C.load.spritesheet("dot","img/game/dot.png",24,24),C.load.spritesheet("one","img/game/one.png",100,100),C.load.spritesheet("two","img/game/two.png",100,100),C.load.spritesheet("three","img/game/three.png",100,100),C.load.spritesheet("door","img/game/door.png",130,130),C.load.spritesheet("charge","img/game/charge.png",60,60),C.load.spritesheet("starburst","img/game/starburst.png",150,150),C.load.spritesheet("numburst","img/game/numburst.png",100,100),C.load.spritesheet("arrow","img/menu/level-arrow.png",110,110),C.load.spritesheet("hint-1","img/game/hint-1.png",250,150),C.load.spritesheet("hint-2","img/game/hint-2.png",150,150),C.load.image("paper-texture","img/paper-texture.png"),C.load.image("pencil","img/game/pencil.png"),C.load.image("pen","img/game/pen.png"),C.load.image("puzzles","img/menu/puzzles.png"),C.load.image("transition","img/transition.png"),C.load.image("endless-dungeon","img/menu/endless-dungeon.png"),C.load.image("logo","img/menu/logo.png"),C.load.image("how-to-play","img/menu/how-to-play.png"),C.load.image("credits","img/menu/credits.png"),C.load.image("info-box","img/game/info-box.png"),C.load.image("question-mark","img/game/question-mark.png"),C.load.image("undo","img/game/undo.png"),C.load.image("exit","img/game/exit.png"),C.load.image("retry","img/menu/retry.png"),C.load.image("main-menu","img/menu/main-menu.png"),C.load.image("back","img/menu/back.png"),C.load.image("unlock-everything","img/menu/unlock-everything.png"),C.load.image("everything-unlocked","img/menu/everything-unlocked.png"),C.load.image("credits-page","img/menu/credits-page.png"),C.load.image("world1","img/menu/world1.png"),C.load.image("worldx","img/menu/worldx.png"),C.load.image("world2","img/menu/world2.png"),C.load.image("worldy","img/menu/worldy.png"),C.load.image("world3","img/menu/world3.png"),C.load.image("worldz","img/menu/worldz.png"),C.load.bitmapFont("handwriting","font/hw5.png","font/hw5.fnt")}},{key:"create",value:function(){if(Cookies.get("dot_dungeons_data")){var e=Cookies.get("dot_dungeons_data");C.data=JSON.parse(e)}else C.data={levels:{"1-1":{unlocked:!0,completed:!1}},highScore:-1};C.tutorial=h,C.levels=[],Object.assign(C.levels,i,o,r,s,l,u);for(var t in C.levels)C.data.levels[t]||(C.data.levels[t]={unlocked:!1,completed:!1});for(var a in C.data.levels)C.levels[a].unlocked=C.data.levels[a].unlocked,C.levels[a].completed=C.data.levels[a].completed;C.infoBox=new c,C.curtain=new d,C.overlay=C.make.tileSprite(0,0,7680,1440,"paper-texture"),C.stage.addChild(C.overlay),C.menuX=0,C.menuY=0,C.stage.backgroundColor=16777215,C.state.start("menu")}}]),t}(),p=function(e){function t(e){_classCallCheck(this,t);var a=C.levels[e],n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,a.x,a.y,"level-button"));return C.add.existing(n),n.anchor.set(.5,.7),n.level=e,n.inputEnabled=!0,a.completed?(n.enabled=!0,n.overFrame=2,n.outFrame=12):a.unlocked?(n.enabled=!0,n.overFrame=6,n.outFrame=11):(n.enabled=!1,n.overFrame=0,n.outFrame=0),n.frame=n.outFrame,n.events.onInputOver.add(function(){this.frame=this.overFrame},n),n.events.onInputOut.add(function(){this.frame=this.outFrame},n),n.events.onInputDown.add(function(){this.frame=12,this.enabled&&(C.currentLevel=this.level,C.curtain.transition("main"))},n),n.animations.add("enable",[1,2,3,4,5,6,7,8,9,10,11],20,!1),n.animations.add("complete",[11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,9,8,7,6,5,4,3,2,1,12],20,!1),C.justCompleted===n.level&&(C.levels[n.level].completed=!0,n.overFrame=2,n.outFrame=12,n.events.onAnimationComplete.addOnce(n.unlockNext,n),n.animations.play("complete"),C.justCompleted=null),n}return _inherits(t,Phaser.Sprite),_createClass(t,[{key:"unlockNext",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,i=C.levels[this.level].unlocks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;if(!C.levels[o].unlocked){C.levels[o].unlocked=!0;var r=C.levels[o].button;r.enabled=!0,r.overFrame=6,r.outFrame=11,r.animations.play("enable")}}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}if("1-5"===this.level){var s=!0,l=!1,u=void 0;try{for(var h,d=C.world1arrows[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var c=h.value;c.enabled||(c.enabled=!0,c.animations.play("enable"))}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}}if("2-5"===this.level){var m=!0,p=!1,y=void 0;try{for(var g,f=C.world2arrows[Symbol.iterator]();!(m=(g=f.next()).done);m=!0){var v=g.value;v.enabled||(v.enabled=!0,v.animations.play("enable"))}}catch(e){p=!0,y=e}finally{try{!m&&f.return&&f.return()}finally{if(p)throw y}}}"3-5"===this.level&&(C.world3arrow.enabled||(C.world3arrow.enabled=!0,C.world3arrow.animations.play("enable")))}}]),t}(),y=function(e){function t(e,a,n,i,o){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,e,a,n));return C.add.existing(r),r.anchor.set(.5),r.targetScale=1,r.inputEnabled=!0,r.onDown=i,r.onDownContext=o,i&&r.events.onInputDown.add(function(){this.scale.set(1),this.onDown.call(o)},r),r.events.onInputUp.add(function(){this.scale.set(1.1)},r),r.events.onInputOver.add(function(){this.scale.set(1.1)},r),r.events.onInputOut.add(function(){this.scale.set(1)},r),r}return _inherits(t,Phaser.Sprite),t}(),g=function(e){function t(e,a,n,i,o,r){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,"arrow"));return s.events.onInputDown.add(function(){this.scale.set(1),this.enabled&&(C.menuX=this.menuX,C.menuY=this.menuY)},s),s.angle=o,s.menuX=n,s.menuY=i,s.enabled=r,r?s.frame=11:s.animations.add("enable",[0,1,2,3,4,5,6,7,8,9,10,11],40,!1),s}return _inherits(t,y),t}(),f=function(e){function t(e,a,n){_classCallCheck(this,t);var i=void 0,o=void 0,r=void 0,s=void 0;"1"===n?(i=[0,1,2,3,4,5,6,7,7,7,7,7,7,7,7,7,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0],o=8,r=1,s="one"):"2"===n?(i=[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,9,10,11,12,13,14,15,16,15,14,13,12,11,10,9],o=17,r=2,s="two"):"3"===n&&(i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],o=32,r=3,s="three");var l=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,e,a,s));return C.add.existing(l),l.anchor.set(.5),l.value=r,l.animations.add("idle",i,20,!0),l.animations.add("die",[o],0,!1),l.animations.play("idle"),l}return _inherits(t,Phaser.Sprite),t}(),v=function(e){function t(e,a,n){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,e,a,"dot"));if(C.add.existing(i),i.anchor.set(.5),i.visited=!1,"1"===n||"2"===n||"3"===n?(i.hasNumber=!0,i.hadNumber=!1,i.number=new f(e,a,n)):(i.hasNumber=!1,i.hadNumber=!1),"X"===n){var o=C.add.sprite(e,a,"door");o.animations.add("unlock",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],20,!1),o.anchor.set(.5),i.door=o,i.locked=!0}else i.locked=!1;if(-1!=="abcdn".indexOf(n)){var r=C.add.sprite(e,a,"question-mark");r.anchor.set(.5),i.qm=r,i.hasInfo=!0}else i.hasInfo=!1;return i}return _inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){if(this.hasInfo&&!this.everVisited&&(this.qm.rotation=Math.sin(C.time.now/200)/6),this.hadNumber){var e=C.time.elapsedMS/1e3;this.number.vy+=1e3*e,this.number.x+=this.number.vx*e,this.number.y+=this.number.vy*e,this.number.rotation+=2*e}}},{key:"markVisited",value:function(){this.hasInfo&&(this.qm.scale.set(.8),this.everVisited=!0),this.visited=!0,this.frame=1}},{key:"unmarkVisited",value:function(){this.visited=!1,this.frame=0}},{key:"defeatNumber",value:function(){this.number.animations.play("die"),this.hasNumber=!1,this.hadNumber=!0,this.number.vx=(1200-this.x)/3,this.number.vy=-1e3}},{key:"reviveNumber",value:function(){this.number.animations.play("idle"),this.hasNumber=!0,this.hadNumber=!1,this.number.x=this.x,this.number.y=this.y,this.number.rotation=0}},{key:"unlock",value:function(){this.locked&&(this.door.animations.play("unlock"),this.locked=!1),this.locked=!1}},{key:"lock",value:function(){this.locked||(this.door.frame=0,this.locked=!0)}}]),t}(),b=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Phaser.State),_createClass(t,[{key:"create",value:function(){Cookies.set("dot_dungeons_data",JSON.stringify(C.data),{expires:365}),C.world.setBounds(0,0,7680,1440),this.graphics=C.add.graphics(0,0),this.buttons=C.add.group(),C.mode="puzzle",C.camera.x=C.menuX,C.camera.y=C.menuY,C.world1arrows=[new g(2400,420,2560,0,180,C.levels["2-1"].unlocked),new g(2200,630,1280,720,270,C.levels["X-1"].unlocked)],C.world2arrows=[new g(3700,290,3840,0,180,C.levels["3-1"].unlocked),new g(3450,580,2560,720,270,C.levels["Y-1"].unlocked)],C.world3arrow=new g(4970,450,3840,720,270,C.levels["Z-1"].unlocked);for(var e in C.levels){var t=new p(e);C.levels[e].button=t}this.scenery=[C.add.image(350,50,"logo"),C.add.image(0,720,"credits-page"),C.add.image(1280,0,"world1"),new f(1890,90,"1"),C.add.image(1280,720,"worldx"),C.add.image(2560,0,"world2"),new f(3250,90,"2"),C.add.image(2560,720,"worldy"),C.add.image(3840,0,"world3"),new f(4250,90,"3"),C.add.image(3840,720,"worldz")],this.buttons=[new y(200,400,"endless-dungeon",function(){C.mode="random",C.room=1,C.onesCaptured=0,C.twosCaptured=0,C.threesCaptured=0,C.curtain.transition("main")},this),new y(1100,400,"puzzles",function(){C.menuX=1280},this),new y(650,400,"how-to-play",function(){C.mode="tutorial",C.room=0,C.curtain.transition("main")},this),new y(650,610,"credits",function(){C.menuY=720},this),new y(160,830,"back",function(){C.menuY=0},this),new g(1400,130,0,0,0,!0),new g(2450,850,1280,0,90,!0),new g(2680,350,1280,0,0,!0),new g(3720,850,2560,0,90,!0),new g(3960,580,2560,0,0,!0),new g(4650,850,3840,0,90,!0)],this.unlockButton=new y(950,1140,"unlock-everything",function(){for(var e in C.levels)C.data.levels[e].unlocked=!0,C.levels[e].unlocked=!0;C.curtain.transition("menu")},this),C.curtain.raise()}},{key:"update",value:function(){var e=C.time.elapsedMS/1e3;C.camera.x+=5*(C.menuX-C.camera.x)*e,C.camera.y+=5*(C.menuY-C.camera.y)*e;var t=this.graphics;t.clear(),t.lineStyle(7,4473924);for(var a in C.levels){var n=C.levels[a],i=!0,o=!1,r=void 0;try{for(var s,l=n.unlocks[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value,h=C.levels[u];h.unlocked&&(t.moveTo(n.button.x,n.button.y),t.lineTo(h.button.x,h.button.y))}}catch(e){o=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}}}}]),t}(),x=function(a){function n(a,i,o){if(_classCallCheck(this,n),o)r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,C,e(a),t(i),"pen"));else var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,C,e(a),t(i),"pencil"));return C.add.existing(r),r.anchor.set(0,1),r.alpha=.5,r.charge=0,r.pos={x:a,y:i},r.next={x:a,y:i},_possibleConstructorReturn(r)}return _inherits(n,Phaser.Image),n}(),k=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,C.width/2,80,"starburst",15));return C.add.existing(e),e.charge=0,e.number=C.add.sprite(e.x,e.y,"charge",5),e.numberCopy=C.add.sprite(e.x,e.y,"charge",5),e.number.anchor.set(.5),e.number.scale.set(0),e.numberCopy.anchor.set(.5),e.animations.add("appear",[14,13,12,11,10,9,8,7,6,5],30,!1),e.animations.add("disappear",[6,7,8,9,10,11,12,13,14,15],30,!1),e.animations.add("pulse",[0,1,2,3,4,5],20,!1),e.anchor.set(.5),e}return _inherits(t,Phaser.Sprite),_createClass(t,[{key:"loseCharge",value:function(){this.charge>0&&(this.charge=0,this.animations.play("disappear"),C.add.tween(this.number.scale).to({x:0,y:0},250).start())}},{key:"gainCharge",value:function(){0===this.charge?(this.animations.play("appear"),C.add.tween(this.number.scale).to({x:1,y:1},250).start()):this.animations.play("pulse"),++this.charge>5&&(this.charge=5),this.number.frame=this.charge-1}},{key:"setCharge",value:function(e){e>5&&(e=5),this.charge=e,0===e?(this.number.scale.set(0),this.frame=15):(this.number.scale.set(1),this.frame=0,this.number.frame=e-1)}},{key:"update",value:function(){var e=C.time.elapsedMS/1e3;this.rotation+=e,this.number.rotation=Math.sin(C.time.now/300)/8}}]),t}(),w=function(i){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return _inherits(o,Phaser.State),_createClass(o,[{key:"create",value:function(){var e=void 0,t=C.add.bitmapText(15,0,"handwriting","",80);if("random"===C.mode)e=n(C.room),t.text="Room "+C.room;else if("tutorial"===C.mode){if(2===C.room){var i=C.add.sprite(523,375,"hint-1");i.animations.add("swish",[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33],20,!0),i.animations.play("swish")}e=C.tutorial[C.room],t.text="How to Play"}else if("puzzle"===C.mode&&(e=C.levels[C.currentLevel],t.text=C.currentLevel,"2-2"===C.currentLevel)){var o=C.add.sprite(523,375,"hint-2");o.animations.add("swish",[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],20,!0),o.animations.play("swish")}var r=a(e);this.graphics=C.add.graphics(0,0),this.numburst=C.add.sprite(0,0,"numburst",6),this.numburst.animations.add("burst",[0,1,2,3,4,5,6],20,!1),this.numburst.anchor.set(.5),this.numburst.scale.set(1),this.ct=new k,this.pencil=new x(r.startX,r.startY,"random"===C.mode);new y(1230,45,"exit",function(){C.infoBox.dismiss(),"random"===C.mode?C.curtain.transition("results"):C.curtain.transition("menu")},this);if("random"!==C.mode)new y(1150,45,"undo",this.undo,this);this.path=[{x:r.startX,y:r.startY,cleared:!1,visited:!0,finished:!1,charge:0}],this.exit=r[r.endY][r.endX],r[r.startY][r.startX].markVisited(),this.map=r,this.calculateValidMoves(),r[r.startY][r.startX].hasInfo&&C.infoBox.appear(r[r.startY][r.startX].info),C.input.onDown.add(this.movePencil,this),C.curtain.raise()}},{key:"movePencil",value:function(){if(this.validMoves.length&&!(C.input.y<100)){var a=this.pencil,n=this.map;a.pos.x=a.next.x,a.pos.y=a.next.y,a.x=e(a.pos.x),a.y=t(a.pos.y);var i=n[a.pos.y][a.pos.x],o={x:a.pos.x,y:a.pos.y,cleared:!1,visited:!1,finished:!1};if(i.hasInfo?C.infoBox.appear(i.info):C.infoBox.dismiss(),i.hasNumber&&this.ct.charge===i.number.value&&("random"===C.mode&&(1===i.number.value?C.onesCaptured++:2===i.number.value?C.twosCaptured++:3===i.number.value&&C.threesCaptured++),n.remaining-=1,this.numburst.x=i.number.x,this.numburst.y=i.number.y,this.numburst.animations.play("burst"),i.defeatNumber(),o.cleared=!0),i.visited?0===C.room&&"tutorial"===C.mode||this.ct.gainCharge():(i.hasInfo&&!i.everVisited&&(n.remaining-=1),this.ct.loseCharge(),i.markVisited(),o.visited=!0),n.remaining<=0&&(this.exit.unlock(),o.finished=!0),o.charge=this.ct.charge,this.path.push(o),this.calculateValidMoves(),a.pos.x===n.endX&&a.pos.y===n.endY)if(this.validMoves=[],"random"===C.mode)C.room++,C.curtain.transition("main");else if("tutorial"===C.mode)C.room++,C.room>=C.tutorial.length?C.curtain.transition("menu"):C.curtain.transition("main");else{C.levels[C.currentLevel].completed||(C.justCompleted=C.currentLevel),C.data.levels[C.currentLevel].completed=!0;var r=!0,s=!1,l=void 0;try{for(var u,h=C.levels[C.currentLevel].unlocks[Symbol.iterator]();!(r=(u=h.next()).done);r=!0){var d=u.value;C.data.levels[d].unlocked=!0}}catch(e){s=!0,l=e}finally{try{!r&&h.return&&h.return()}finally{if(s)throw l}}C.curtain.transition("menu")}}}},{key:"calculateValidMoves",value:function(){var e=this.pencil,t=this.path;this.validMoves=[];for(var a=-1;a<2;a++)for(var n=-1;n<2;n++)if((0!==a||0!==n)&&null!==this.map[e.pos.y+n][e.pos.x+a]&&!this.map[e.pos.y+n][e.pos.x+a].locked){for(var i=!0,o=0;o<this.path.length-1;o++){if(t[o].x===e.pos.x&&t[o].y===e.pos.y&&t[o+1].x===e.pos.x+a&&t[o+1].y===e.pos.y+n){i=!1;break}if(t[o].x===e.pos.x+a&&t[o].y===e.pos.y+n&&t[o+1].x===e.pos.x&&t[o+1].y===e.pos.y){i=!1;break}}i&&this.validMoves.push({x:a,y:n})}0===this.validMoves.length&&"random"===C.mode&&C.curtain.transition("results")}},{key:"update",value:function(){var a=this.pencil,n=Number.POSITIVE_INFINITY,i=!0,o=!1,r=void 0;try{for(var s,l=this.validMoves[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value,h=Phaser.Math.distance(C.input.x,C.input.y,e(a.pos.x+u.x),t(a.pos.y+u.y));h<n&&(a.next.x=a.pos.x+u.x,a.next.y=a.pos.y+u.y,n=h)}}catch(e){o=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}var d=this.graphics,c=this.path;d.clear(),d.lineStyle(9,4473924),d.moveTo(e(c[0].x),t(c[0].y));for(var m=1;m<c.length;m++)d.lineTo(e(c[m].x),t(c[m].y));d.lineStyle(8,4473924,.15),d.lineTo(e(a.next.x),t(a.next.y))}},{key:"undo",value:function(){if(!(this.path.length<=1)){var a=this.path.pop(),n=this.path[this.path.length-1],i=this.pencil;i.pos.x=n.x,i.pos.y=n.y,i.x=e(n.x),i.y=t(n.y),this.ct.setCharge(n.charge),a.cleared&&(this.map[a.y][a.x].reviveNumber(),this.map.remaining++,a.finished&&this.exit.lock()),a.visited&&this.map[a.y][a.x].unmarkVisited(),this.map[n.y][n.x].hasInfo?C.infoBox.appear(this.map[n.y][n.x].info):C.infoBox.dismiss(),this.calculateValidMoves()}}}]),o}(),_=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Phaser.State),_createClass(t,[{key:"create",value:function(){var e=C.room-1;C.add.bitmapText(420,50,"handwriting","Rooms cleared: ",80),C.add.bitmapText(860,50,"handwriting",e+"",80).anchor.set(1,0),e>C.data.highScore?(C.data.highScore=e,this.highScoreText=C.add.bitmapText(640,180,"handwriting","Personal best!",80),this.highScoreText.anchor.set(.5,.5),this.newHighScore=!0):(C.add.bitmapText(420,125,"handwriting","Your best: ",80),C.add.bitmapText(860,125,"handwriting",C.data.highScore+"",80).anchor.set(1,0),this.newHighScore=!1),C.add.bitmapText(640,300,"handwriting","Numbers captured:",80).anchor.set(.5,0),new f(300,450,"1"),new f(600,450,"2"),new f(900,450,"3"),C.add.bitmapText(340,415,"handwriting","x "+C.onesCaptured,80),C.add.bitmapText(640,415,"handwriting","x "+C.twosCaptured,80),C.add.bitmapText(940,415,"handwriting","x "+C.threesCaptured,80),new y(460,600,"retry",function(){C.mode="random",C.room=1,C.onesCaptured=0,C.twosCaptured=0,C.threesCaptured=0,C.curtain.transition("main")},this),new y(760,605,"main-menu",function(){C.curtain.transition("menu")},this),C.curtain.raise()}},{key:"update",value:function(){this.newHighScore&&this.highScoreText.scale.set(1+.2*Math.sin(.005*C.time.now))}}]),t}(),C=new Phaser.Game(1280,720,Phaser.AUTO,"game");return C.state.add("load",m),C.state.add("menu",b),C.state.add("main",w),C.state.add("results",_),C.state.start("load"),C}();