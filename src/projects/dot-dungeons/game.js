"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),game=function(){function e(e){return 150+100*e}function t(e){return 100+100*e}function a(a){var n=[];n.remaining=0;for(var o=a.layout,i=0;i<o.length;i++){for(var s=[],r=0;r<o[i].length;r++){var l=o[i][r];if(" "===l)s.push(null);else{var u=new v(e(r),t(i),l);(u.hasNumber||u.hasInfo)&&n.remaining++,u.hasInfo&&(u.info=a.info[l]),s.push(u)}"N"!==l&&"n"!==l||(n.startX=r,n.startY=i,"n"===l&&n.remaining--),"X"===l&&(n.endX=r,n.endY=i)}n.push(s)}return n}function n(e){var t=Math.min(23,13+.5*e),a=Math.min(25,15+.5*e),n=Math.min(23,3+e),o=Math.min(25,5+e),i=void 0,s=void 0,r=0;do{r++,s=!1,i=[Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" ")];var l=1+Math.floor(7*Math.random()),u=1+Math.floor(5*Math.random()),d=[],h=0,c=0,m=0;for(i[u][l]="N";;){d.push({x:l,y:u});for(var p=[],g=-1;g<2;g++)for(var f=-1;f<2;f++)if((0!==g||0!==f)&&l+g>0&&u+f>0&&l+g<8&&u+f<6){for(var y=!0,v=0;v<d.length-1;v++){if(d[v].x===l&&d[v].y===u&&d[v+1].x===l+g&&d[v+1].y===u+f){y=!1;break}if(d[v].x===l+g&&d[v].y===u+f&&d[v+1].x===l&&d[v+1].y===u){y=!1;break}}y&&p.push({x:g,y:f})}if(0===p.length){s=!0;break}var x=p[Math.floor(Math.random()*p.length)];if(l+=x.x,u+=x.y," "===i[u][l]){if(m>=n&&h>=t){i[u][l]="X";break}if(c<4?(i[u][l]=""+c,m+=c,3===c&&m++):i[u][l]="0",++h>a||m>o){s=!0;break}c=0}else c++}}while(s);return console.log("It took "+r+" attempts to generate this level."),{layout:i}}var o={"1-1":{x:1440,y:270,layout:["           ","   00000   ","   00000   ","  N00100X  ","   00000   ","   00000   ","           "],unlocks:["1-2"]},"1-2":{x:1700,y:270,layout:["          ","          ","   0000   ","  N0110X  ","   0000   ","          ","          "],unlocks:["1-3"]},"1-3":{x:1950,y:340,layout:["           ","           ","  N01110X  ","   00000   ","           ","           "],unlocks:["1-4"]},"1-4":{x:2050,y:500,layout:["           ","           ","    101    ","   N000X   ","    101    ","           ","           "],unlocks:["1-5"]},"1-5":{x:2330,y:550,layout:["          ","    00    ","    01    ","    01    ","    01    ","   N01X   ","          "],unlocks:["X-1","2-1"]}},i={"X-1":{x:2330,y:890,layout:["           ","   10101   ","   01110   ","  N11111X  ","   01110   ","   10101   ","           "],unlocks:["X-2"]},"X-2":{x:2050,y:940,layout:["          ","          ","   0111   ","  N0111X  ","   0111   ","          ","          "],unlocks:["X-3"]},"X-3":{x:1950,y:1100,layout:["           ","           ","  N11111X  ","   00000   ","           ","           "],unlocks:["X-4"]},"X-4":{x:1700,y:1170,layout:["           ","           ","    111    ","   N001X   ","    111    ","           ","           "],unlocks:["X-5"]},"X-5":{x:1440,y:1170,layout:["          ","    01    ","    01    ","    01    ","    01    ","   N01X   ","          "],unlocks:[]}},s={"2-1":{x:2670,y:540,layout:["          ","          ","    00    ","  N0002X  ","    00    ","          ","          "],unlocks:["2-2"]},"2-2":{x:2930,y:500,layout:["          ","    00X   ","    02    ","    01    ","   N00    ","          "],unlocks:["2-3"]},"2-3":{x:3100,y:320,layout:["           ","     2     ","    010    ","   N000X   ","    010    ","     2     ","           "],unlocks:["2-4"]},"2-4":{x:3370,y:300,layout:["           ","    N X    ","   00000   ","   00 00   ","   02020   ","           "],unlocks:["2-5"]},"2-5":{x:3610,y:430,layout:["           ","    202    ","    000    ","   N000X   ","    000    ","    202    ","           "],unlocks:["Y-1","3-1"]}},r={"Y-1":{x:3610,y:1010,layout:["          ","          ","    00    ","  N0220X  ","    00    ","          ","          "],unlocks:["Y-2"]},"Y-2":{x:3370,y:1140,layout:["          ","    00X   ","    22    ","    11    ","   N00    ","          "],unlocks:["Y-3"]},"Y-3":{x:3100,y:1120,layout:["           ","     2     ","    010    ","   N121X   ","    010    ","     2     ","           "],unlocks:["Y-4"]},"Y-4":{x:2930,y:940,layout:["           ","    N X    ","   02020   ","   00 00   ","   02020   ","           "],unlocks:["Y-5"]},"Y-5":{x:2670,y:900,layout:["           ","    202   ","    000   ","   N000X   ","    000    ","    222  ","           "],unlocks:[]}},l={"3-1":{x:3960,y:430,layout:["           ","           ","    000    ","   N030X   ","    000    ","           ","           "],unlocks:["3-2"]},"3-2":{x:4185,y:290,layout:["          ","   N03X   ","    02    ","    01    ","    00    ","    00    ","          "],unlocks:["3-3"]},"3-3":{x:4510,y:265,layout:["          ","          ","   0030   ","  N0000X  ","   0300   ","          ","          "],unlocks:["3-4"]},"3-4":{x:4765,y:385,layout:["           ","   00300   ","   01010   ","  N00 00X  ","   01010   ","   00300   ","           "],unlocks:["3-5"]},"3-5":{x:4850,y:585,layout:["           ","           ","   10203   ","  N00000X  ","   10203   ","           ","           "],unlocks:["Z-1"]}},u={"Z-1":{x:4850,y:855,layout:["           ","           ","    030    ","   N000X   ","    030    ","           ","           "],unlocks:["Z-2"]},"Z-2":{x:4765,y:1055,layout:["          ","   N03X   ","    02    ","    01    ","    02    ","    03    ","          "],unlocks:["Z-3"]},"Z-3":{x:4510,y:1175,layout:["          ","          ","   3003   ","  N0000X  ","   3003   ","          ","          "],unlocks:["Z-4"]},"Z-4":{x:4185,y:1150,layout:["           ","   00100   ","   03030   ","  N00 00X  ","   03030   ","   00100   ","           "],unlocks:["Z-5"]},"Z-5":{x:3960,y:1010,layout:["           ","           ","   30201   ","  N00000X  ","   30201   ","           ","           "],unlocks:[]}},d=[{layout:["           ","    0a00b  ","  n0000    ","    0000X  ","           ","           "],info:{n:"CLICK to move!",a:"You can't retrace your own path, but you can\nrevisit dots you've been to before.",b:"If you ever get stuck, you can press           to go\nback one step."}},{layout:["           ","   000  X  ","   0 0 000 "," N000a 000 ","   0   000 ","   b0000c0 ","           "],info:{a:"Revisiting dots that you've been to before builds\nup CHARGE.",b:"But if you visit a dot for the first time, your\ncharge goes away.",c:"So, to build up a charge of more than 1, you need\nto revisit multiple dots in a row."}},{layout:["           "," Na0b0     ","   00000   ","   00010X  ","   00000   ","           "],info:{a:"In each room, you need to CAPTURE all of the\nnumbers, then get to the exit.",b:"To capture a number, first build up a charge\nequal to it, then touch it."}}],h=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,C.width/2,0,"transition"));return C.stage.addChild(e),e.anchor.set(.5,0),e.falling=!1,e.newState="menu",e}return _inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){this.falling?(this.y=Math.min(0,this.y+2.5*C.time.elapsedMS),this.y>=0&&(C.state.start(this.newState),this.falling=!1,C.sfx.swoosh.play())):this.y+=2.5*C.time.elapsedMS}},{key:"raise",value:function(){this.y=C.height,this.angle=180}},{key:"transition",value:function(e){this.newState=e,this.falling=!0,this.y=-1e3,this.angle=0}}]),t}(),c=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,100,C.height,"info-box"));return C.stage.addChild(e),e.text=C.make.bitmapText(e.x+40,e.y+30,"handwriting","",70),C.stage.addChild(e.text),e.targetY=e.y,e.undoIcon=C.make.image(850,0,"undo"),C.stage.addChild(e.undoIcon),e}return _inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){var e=C.time.elapsedMS/1e3;this.y+=10*(this.targetY-this.y)*e,this.text.y=this.y+30,this.undoIcon.y=this.y+32}},{key:"appear",value:function(e){-1!==e.indexOf("    ")?this.undoIcon.alpha=1:this.undoIcon.alpha=0,this.text.text=e,this.targetY=450}},{key:"dismiss",value:function(){this.targetY=C.height}}]),t}(),m=function(e){function t(e){_classCallCheck(this,t);var a=C.levels[e],n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,a.x,a.y,"level-button"));return C.add.existing(n),n.anchor.set(.5,.7),n.level=e,n.inputEnabled=!0,a.completed?(n.enabled=!0,n.overFrame=2,n.outFrame=12):a.unlocked?(n.enabled=!0,n.overFrame=6,n.outFrame=11):(n.enabled=!1,n.overFrame=0,n.outFrame=0),n.frame=n.outFrame,n.events.onInputOver.add(function(){this.frame=this.overFrame},n),n.events.onInputOut.add(function(){this.frame=this.outFrame},n),n.events.onInputDown.add(function(){C.sfx.click.play(),this.frame=12,this.enabled&&(C.currentLevel=this.level,C.curtain.transition("main"))},n),n.animations.add("enable",[1,2,3,4,5,6,7,8,9,10,11],20,!1),n.animations.add("complete",[11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,9,8,7,6,5,4,3,2,1,12],20,!1),C.justCompleted===n.level&&(C.levels[n.level].completed=!0,n.overFrame=2,n.outFrame=12,n.events.onAnimationComplete.addOnce(n.unlockNext,n),n.animations.play("complete"),C.justCompleted=null),n}return _inherits(t,Phaser.Sprite),_createClass(t,[{key:"unlockNext",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,o=C.levels[this.level].unlocks[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;if(!C.levels[i].unlocked){C.levels[i].unlocked=!0;var s=C.levels[i].button;s.enabled=!0,s.overFrame=6,s.outFrame=11,s.animations.play("enable")}}}catch(e){t=!0,a=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw a}}if("1-5"===this.level){var r=!0,l=!1,u=void 0;try{for(var d,h=C.world1arrows[Symbol.iterator]();!(r=(d=h.next()).done);r=!0){var c=d.value;c.enabled||(c.enabled=!0,c.animations.play("enable"))}}catch(e){l=!0,u=e}finally{try{!r&&h.return&&h.return()}finally{if(l)throw u}}}if("2-5"===this.level){var m=!0,p=!1,g=void 0;try{for(var f,y=C.world2arrows[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var v=f.value;v.enabled||(v.enabled=!0,v.animations.play("enable"))}}catch(e){p=!0,g=e}finally{try{!m&&y.return&&y.return()}finally{if(p)throw g}}}"3-5"===this.level&&(C.world3arrow.enabled||(C.world3arrow.enabled=!0,C.world3arrow.animations.play("enable")))}}]),t}(),p=function(e){function t(e,a,n,o,i){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,e,a,n));return C.add.existing(s),s.anchor.set(.5),s.targetScale=1,s.inputEnabled=!0,s.onDown=o,s.onDownContext=i,o&&s.events.onInputDown.add(function(){C.sfx.click.play(),this.scale.set(1),this.onDown.call(i)},s),s.events.onInputUp.add(function(){this.scale.set(1),C.sfx.click.play()},s),s.events.onInputOver.add(function(){this.scale.set(1.1)},s),s.events.onInputOut.add(function(){this.scale.set(1)},s),s}return _inherits(t,Phaser.Sprite),t}(),g=function(e){function t(e,a,n,o,i,s){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,"arrow"));return r.events.onInputDown.add(function(){C.sfx.click.play(),this.scale.set(1),this.enabled&&(C.menuX=this.menuX,C.menuY=this.menuY)},r),r.angle=i,r.menuX=n,r.menuY=o,r.enabled=s,s?r.frame=11:r.animations.add("enable",[0,1,2,3,4,5,6,7,8,9,10,11],40,!1),r}return _inherits(t,p),t}(),f=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Phaser.State),_createClass(t,[{key:"preload",value:function(){C.add.text(C.width/2,C.height/2,"Loading...",{font:"30px sans-serif",fill:"#ffffff",align:"center"}).anchor.set(.5),C.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,C.scale.windowConstraints.bottom="layout",C.load.spritesheet("level-button","img/menu/level-button.png",70,70),C.load.spritesheet("dot","img/game/dot.png",24,24),C.load.spritesheet("one","img/game/one.png",100,100),C.load.spritesheet("two","img/game/two.png",100,100),C.load.spritesheet("three","img/game/three.png",100,100),C.load.spritesheet("door","img/game/door.png",130,130),C.load.spritesheet("charge","img/game/charge.png",60,60),C.load.spritesheet("starburst","img/game/starburst.png",150,150),C.load.spritesheet("numburst","img/game/numburst.png",100,100),C.load.spritesheet("arrow","img/menu/level-arrow.png",110,110),C.load.spritesheet("hint-1","img/game/hint-1.png",250,150),C.load.spritesheet("hint-2","img/game/hint-2.png",150,150),C.load.spritesheet("volume","img/volume.png",76,72),C.load.image("logo","img/logo.png"),C.load.image("paper-texture","img/paper-texture.png"),C.load.image("transition","img/transition.png"),C.load.image("pencil","img/game/pencil.png"),C.load.image("pen","img/game/pen.png"),C.load.image("puzzles","img/menu/puzzles.png"),C.load.image("endless-dungeon","img/menu/endless-dungeon.png"),C.load.image("how-to-play","img/menu/how-to-play.png"),C.load.image("credits","img/menu/credits.png"),C.load.image("info-box","img/game/info-box.png"),C.load.image("question-mark","img/game/question-mark.png"),C.load.image("undo","img/game/undo.png"),C.load.image("exit","img/game/exit.png"),C.load.image("retry","img/menu/retry.png"),C.load.image("main-menu","img/menu/main-menu.png"),C.load.image("back","img/menu/back.png"),C.load.image("unlock-everything","img/menu/unlock-everything.png"),C.load.image("credits-page","img/menu/credits-page.png"),C.load.image("world1","img/menu/world1.png"),C.load.image("worldx","img/menu/worldx.png"),C.load.image("world2","img/menu/world2.png"),C.load.image("worldy","img/menu/worldy.png"),C.load.image("world3","img/menu/world3.png"),C.load.image("worldz","img/menu/worldz.png"),C.load.audio("pen","sfx/pen.ogg"),C.load.audio("click","sfx/click.ogg"),C.load.audio("music","sfx/music.ogg"),C.load.audio("door","sfx/door.ogg"),C.load.audio("charge1","sfx/charge1.ogg"),C.load.audio("charge2","sfx/charge2.ogg"),C.load.audio("charge3","sfx/charge3.ogg"),C.load.audio("charge4","sfx/charge4.ogg"),C.load.audio("charge5","sfx/charge5.ogg"),C.load.audio("swoosh","sfx/swoosh.ogg"),C.load.audio("whack","sfx/whack.ogg"),C.load.audio("oof","sfx/oof.ogg"),C.load.audio("whack","sfx/whack.ogg"),C.load.audio("aah","sfx/aah.ogg"),C.load.bitmapFont("handwriting","font/hw5.png","font/hw5.fnt")}},{key:"create",value:function(){if(C.sfx={music:C.add.audio("music",1,!0),pen:C.add.audio("pen",.8,!1),click:C.add.audio("click",1.2,!1),door:C.add.audio("door",1,!1),charge:[C.add.audio("charge1",1.5,!1),C.add.audio("charge2",1.5,!1),C.add.audio("charge3",1.5,!1),C.add.audio("charge4",1.5,!1),C.add.audio("charge5",1.5,!1)],swoosh:C.add.audio("swoosh",.15,!1),whack:C.add.audio("whack",.5,!1),oof:C.add.audio("oof",.15,!1),aah:C.add.audio("aah",.15,!1)},Cookies.get("dot_dungeons_data")){var e=Cookies.get("dot_dungeons_data");C.data=JSON.parse(e)}else C.data={levels:{"1-1":{unlocked:!0,completed:!1}},highScore:-1,soundSetting:0};C.tutorial=d,C.levels=[],Object.assign(C.levels,o,i,s,r,l,u);for(var t in C.levels)C.data.levels[t]||(C.data.levels[t]={unlocked:!1,completed:!1});for(var a in C.data.levels)C.levels[a].unlocked=C.data.levels[a].unlocked,C.levels[a].completed=C.data.levels[a].completed;C.soundButton=new p(1220,45,"volume",function(){0===this.data.soundSetting?(this.sound.mute=!0,this.sfx.music.stop(),this.data.soundSetting=1,this.soundButton.frame=1):1===this.data.soundSetting?(this.sound.mute=!1,this.data.soundSetting=2,this.soundButton.frame=2):2===this.data.soundSetting&&(this.sfx.music.play(),this.data.soundSetting=0,this.soundButton.frame=0),Cookies.set("dot_dungeons_data",JSON.stringify(C.data),{expires:365})},C),0===C.data.soundSetting?(C.sfx.music.play(),C.soundButton.frame=0):1===C.data.soundSetting?(C.sound.mute=!0,C.soundButton.frame=1):2===C.data.soundSetting&&(C.soundButton.frame=2),C.stage.addChild(C.soundButton),C.infoBox=new c,C.curtain=new h,C.overlay=C.make.tileSprite(0,0,7680,1440,"paper-texture"),C.stage.addChild(C.overlay),C.menuX=0,C.menuY=0,C.stage.backgroundColor=16777215,C.state.start("menu")}}]),t}(),y=function(e){function t(e,a,n){_classCallCheck(this,t);var o=void 0,i=void 0,s=void 0,r=void 0;"1"===n?(o=[0,1,2,3,4,5,6,7,7,7,7,7,7,7,7,7,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0],i=8,s=1,r="one"):"2"===n?(o=[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,9,10,11,12,13,14,15,16,15,14,13,12,11,10,9],i=17,s=2,r="two"):"3"===n&&(o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],i=32,s=3,r="three");var l=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,e,a,r));return C.add.existing(l),l.anchor.set(.5),l.value=s,l.animations.add("idle",o,20,!0),l.animations.add("die",[i],0,!1),l.animations.play("idle"),l}return _inherits(t,Phaser.Sprite),t}(),v=function(e){function t(e,a,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,e,a,"dot"));if(C.add.existing(o),o.anchor.set(.5),o.visited=!1,"1"===n||"2"===n||"3"===n?(o.hasNumber=!0,o.hadNumber=!1,o.number=new y(e,a,n)):(o.hasNumber=!1,o.hadNumber=!1),"X"===n){var i=C.add.sprite(e,a,"door");i.animations.add("unlock",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],20,!1),i.anchor.set(.5),o.door=i,o.locked=!0}else o.locked=!1;if(-1!=="abcdn".indexOf(n)){var s=C.add.sprite(e,a,"question-mark");s.anchor.set(.5),o.qm=s,o.hasInfo=!0}else o.hasInfo=!1;return o}return _inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){if(this.hasInfo&&!this.everVisited&&(this.qm.rotation=Math.sin(C.time.now/200)/6),this.hadNumber){var e=C.time.elapsedMS/1e3;this.number.vy+=1e3*e,this.number.x+=this.number.vx*e,this.number.y+=this.number.vy*e,this.number.rotation+=2*e}}},{key:"markVisited",value:function(){this.hasInfo&&(this.qm.scale.set(.8),this.everVisited=!0),this.visited=!0,this.frame=1}},{key:"unmarkVisited",value:function(){this.visited=!1,this.frame=0}},{key:"defeatNumber",value:function(){C.sfx.whack.play();var e=Math.random();e>.8?C.sfx.aah.play():e>.6&&C.sfx.oof.play(),this.number.animations.play("die"),this.hasNumber=!1,this.hadNumber=!0,this.number.vx=(1200-this.x)/3,this.number.vy=-1e3}},{key:"reviveNumber",value:function(){this.number.animations.play("idle"),this.hasNumber=!0,this.hadNumber=!1,this.number.x=this.x,this.number.y=this.y,this.number.rotation=0}},{key:"unlock",value:function(){this.locked&&(this.door.animations.play("unlock"),C.sfx.door.play(),this.locked=!1),this.locked=!1}},{key:"lock",value:function(){this.locked||(this.door.frame=0,this.locked=!0)}}]),t}(),x=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Phaser.State),_createClass(t,[{key:"create",value:function(){Cookies.set("dot_dungeons_data",JSON.stringify(C.data),{expires:365}),C.world.setBounds(0,0,7680,1440),this.graphics=C.add.graphics(0,0),this.buttons=C.add.group(),C.mode="puzzle",C.camera.x=C.menuX,C.camera.y=C.menuY,C.world1arrows=[new g(2400,420,2560,0,180,C.levels["2-1"].unlocked),new g(2200,630,1280,720,270,C.levels["X-1"].unlocked)],C.world2arrows=[new g(3700,290,3840,0,180,C.levels["3-1"].unlocked),new g(3450,580,2560,720,270,C.levels["Y-1"].unlocked)],C.world3arrow=new g(4970,450,3840,720,270,C.levels["Z-1"].unlocked);for(var e in C.levels){var t=new m(e);C.levels[e].button=t}this.scenery=[C.add.image(350,50,"logo"),C.add.image(0,720,"credits-page"),C.add.image(1280,0,"world1"),new y(1890,90,"1"),C.add.image(1280,720,"worldx"),C.add.image(2560,0,"world2"),new y(3250,90,"2"),C.add.image(2560,720,"worldy"),C.add.image(3840,0,"world3"),new y(4250,90,"3"),C.add.image(3840,720,"worldz")],this.buttons=[new p(200,400,"endless-dungeon",function(){C.mode="random",C.room=1,C.onesCaptured=0,C.twosCaptured=0,C.threesCaptured=0,C.curtain.transition("main")},this),new p(1100,400,"puzzles",function(){C.menuX=1280},this),new p(650,400,"how-to-play",function(){C.mode="tutorial",C.room=0,C.curtain.transition("main")},this),new p(650,610,"credits",function(){C.menuY=720},this),new p(160,830,"back",function(){C.menuY=0},this),new g(1400,130,0,0,0,!0),new g(2450,850,1280,0,90,!0),new g(2680,350,1280,0,0,!0),new g(3720,850,2560,0,90,!0),new g(3960,580,2560,0,0,!0),new g(4650,850,3840,0,90,!0)],this.unlockButton=new p(950,1140,"unlock-everything",function(){for(var e in C.levels)C.data.levels[e].unlocked=!0,C.levels[e].unlocked=!0;C.curtain.transition("menu")},this),C.soundButton.x=1220,C.curtain.raise()}},{key:"update",value:function(){var e=C.time.elapsedMS/1e3;C.camera.x+=5*(C.menuX-C.camera.x)*e,C.camera.y+=5*(C.menuY-C.camera.y)*e;var t=this.graphics;t.clear(),t.lineStyle(7,4473924);for(var a in C.levels){var n=C.levels[a],o=!0,i=!1,s=void 0;try{for(var r,l=n.unlocks[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var u=r.value,d=C.levels[u];d.unlocked&&(t.moveTo(n.button.x,n.button.y),t.lineTo(d.button.x,d.button.y))}}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}}}}]),t}(),b=function(a){function n(a,o,i){if(_classCallCheck(this,n),i)s=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,C,e(a),t(o),"pen"));else var s=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,C,e(a),t(o),"pencil"));return C.add.existing(s),s.anchor.set(0,1),s.alpha=.5,s.charge=0,s.pos={x:a,y:o},s.next={x:a,y:o},_possibleConstructorReturn(s)}return _inherits(n,Phaser.Image),n}(),k=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,C,C.width/2,80,"starburst",15));return C.add.existing(e),e.charge=0,e.number=C.add.sprite(e.x,e.y,"charge",5),e.numberCopy=C.add.sprite(e.x,e.y,"charge",5),e.number.anchor.set(.5),e.number.scale.set(0),e.numberCopy.anchor.set(.5),e.animations.add("appear",[14,13,12,11,10,9,8,7,6,5],30,!1),e.animations.add("disappear",[6,7,8,9,10,11,12,13,14,15],30,!1),e.animations.add("pulse",[0,1,2,3,4,5],20,!1),e.anchor.set(.5),e}return _inherits(t,Phaser.Sprite),_createClass(t,[{key:"loseCharge",value:function(){this.charge>0&&(this.charge=0,this.animations.play("disappear"),C.add.tween(this.number.scale).to({x:0,y:0},250).start())}},{key:"gainCharge",value:function(){0===this.charge?(this.animations.play("appear"),C.add.tween(this.number.scale).to({x:1,y:1},250).start()):this.animations.play("pulse"),++this.charge>5&&(this.charge=5),this.number.frame=this.charge-1,C.sfx.charge[this.charge-1].play()}},{key:"setCharge",value:function(e){e>5&&(e=5),this.charge=e,0===e?(this.number.scale.set(0),this.frame=15):(this.number.scale.set(1),this.frame=5,this.number.frame=e-1)}},{key:"update",value:function(){var e=C.time.elapsedMS/1e3;this.rotation+=e,this.number.rotation=Math.sin(C.time.now/300)/8}}]),t}(),w=function(o){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,Phaser.State),_createClass(i,[{key:"create",value:function(){var e=void 0,t=C.add.bitmapText(15,0,"handwriting","",80);if("random"===C.mode)e=n(C.room),t.text="Room "+C.room;else if("tutorial"===C.mode){if(2===C.room){var o=C.add.sprite(523,375,"hint-1");o.animations.add("swish",[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33],20,!0),o.animations.play("swish")}e=C.tutorial[C.room],t.text="How to Play"}else if("puzzle"===C.mode&&(e=C.levels[C.currentLevel],t.text=C.currentLevel,"2-2"===C.currentLevel)){var i=C.add.sprite(523,375,"hint-2");i.animations.add("swish",[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],20,!0),i.animations.play("swish")}var s=a(e);this.graphics=C.add.graphics(0,0),this.numburst=C.add.sprite(0,0,"numburst",6),this.numburst.animations.add("burst",[0,1,2,3,4,5,6],20,!1),this.numburst.anchor.set(.5),this.numburst.scale.set(1),this.ct=new k,this.pencil=new b(s.startX,s.startY,"random"===C.mode);new p(1230,45,"exit",function(){C.infoBox.dismiss(),"random"===C.mode?C.curtain.transition("results"):C.curtain.transition("menu")},this);if("random"!==C.mode)new p(1150,45,"undo",this.undo,this);C.soundButton.x=1060,this.path=[{x:s.startX,y:s.startY,cleared:!1,visited:!0,finished:!1,charge:0}],this.exit=s[s.endY][s.endX],s[s.startY][s.startX].markVisited(),this.map=s,this.calculateValidMoves(),s[s.startY][s.startX].hasInfo&&C.infoBox.appear(s[s.startY][s.startX].info),this.justPaused=!1,C.input.activePointer.leftButton.onDown.add(this.movePencil,this),C.curtain.raise()}},{key:"paused",value:function(){this.justPaused=!0}},{key:"movePencil",value:function(){if("menu"!==C.state.current&&"results"!==C.state.current&&this.validMoves.length&&!(C.input.y<100))if(this.justPaused)this.justPaused=!1;else{C.sfx.pen.play();var a=this.pencil,n=this.map;a.pos.x=a.next.x,a.pos.y=a.next.y,a.x=e(a.pos.x),a.y=t(a.pos.y);var o=n[a.pos.y][a.pos.x],i={x:a.pos.x,y:a.pos.y,cleared:!1,visited:!1,finished:!1};if(o.hasInfo?C.infoBox.appear(o.info):C.infoBox.dismiss(),o.hasNumber&&this.ct.charge===o.number.value&&("random"===C.mode&&(1===o.number.value?C.onesCaptured++:2===o.number.value?C.twosCaptured++:3===o.number.value&&C.threesCaptured++),n.remaining-=1,this.numburst.x=o.number.x,this.numburst.y=o.number.y,this.numburst.animations.play("burst"),o.defeatNumber(),i.cleared=!0),o.visited?0===C.room&&"tutorial"===C.mode||this.ct.gainCharge():(o.hasInfo&&!o.everVisited&&(n.remaining-=1),this.ct.loseCharge(),o.markVisited(),i.visited=!0),n.remaining<=0&&(this.exit.unlock(),i.finished=!0),i.charge=this.ct.charge,this.path.push(i),this.calculateValidMoves(),a.pos.x===n.endX&&a.pos.y===n.endY)if(this.validMoves=[],"random"===C.mode)C.room++,C.curtain.transition("main");else if("tutorial"===C.mode)C.room++,C.room>=C.tutorial.length?C.curtain.transition("menu"):C.curtain.transition("main");else{C.levels[C.currentLevel].completed||(C.justCompleted=C.currentLevel),C.data.levels[C.currentLevel].completed=!0;var s=!0,r=!1,l=void 0;try{for(var u,d=C.levels[C.currentLevel].unlocks[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value;C.data.levels[h].unlocked=!0}}catch(e){r=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(r)throw l}}C.curtain.transition("menu")}}}},{key:"calculateValidMoves",value:function(){var e=this.pencil,t=this.path;this.validMoves=[];for(var a=-1;a<2;a++)for(var n=-1;n<2;n++)if((0!==a||0!==n)&&null!==this.map[e.pos.y+n][e.pos.x+a]&&!this.map[e.pos.y+n][e.pos.x+a].locked){for(var o=!0,i=0;i<this.path.length-1;i++){if(t[i].x===e.pos.x&&t[i].y===e.pos.y&&t[i+1].x===e.pos.x+a&&t[i+1].y===e.pos.y+n){o=!1;break}if(t[i].x===e.pos.x+a&&t[i].y===e.pos.y+n&&t[i+1].x===e.pos.x&&t[i+1].y===e.pos.y){o=!1;break}}o&&this.validMoves.push({x:a,y:n})}0===this.validMoves.length&&"random"===C.mode&&C.curtain.transition("results")}},{key:"update",value:function(){var a=this.pencil,n=Number.POSITIVE_INFINITY,o=!0,i=!1,s=void 0;try{for(var r,l=this.validMoves[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var u=r.value,d=Phaser.Math.distance(C.input.activePointer.x,C.input.activePointer.y,e(a.pos.x+u.x),t(a.pos.y+u.y));d<n&&(a.next.x=a.pos.x+u.x,a.next.y=a.pos.y+u.y,n=d)}}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}var h=this.graphics,c=this.path;h.clear(),h.lineStyle(9,4473924),h.moveTo(e(c[0].x),t(c[0].y));for(var m=1;m<c.length;m++)h.lineTo(e(c[m].x),t(c[m].y));C.input.activePointer.y>100&&(h.lineStyle(8,4473924,.15),h.lineTo(e(a.next.x),t(a.next.y)))}},{key:"undo",value:function(){if(!(this.path.length<=1)){var a=this.path.pop(),n=this.path[this.path.length-1],o=this.pencil;o.pos.x=n.x,o.pos.y=n.y,o.x=e(n.x),o.y=t(n.y),this.ct.setCharge(n.charge),a.cleared&&(this.map[a.y][a.x].reviveNumber(),this.map.remaining++,a.finished&&this.exit.lock()),a.visited&&this.map[a.y][a.x].unmarkVisited(),this.map[n.y][n.x].hasInfo?C.infoBox.appear(this.map[n.y][n.x].info):C.infoBox.dismiss(),this.calculateValidMoves()}}}]),i}(),_=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Phaser.State),_createClass(t,[{key:"create",value:function(){var e=C.room-1;C.add.bitmapText(420,50,"handwriting","Rooms cleared: ",80),C.add.bitmapText(860,50,"handwriting",e+"",80).anchor.set(1,0),e>C.data.highScore?(C.data.highScore=e,this.highScoreText=C.add.bitmapText(640,180,"handwriting","Personal best!",80),this.highScoreText.anchor.set(.5,.5),this.newHighScore=!0):(C.add.bitmapText(420,125,"handwriting","Your best: ",80),C.add.bitmapText(860,125,"handwriting",C.data.highScore+"",80).anchor.set(1,0),this.newHighScore=!1),C.add.bitmapText(640,300,"handwriting","Numbers captured:",80).anchor.set(.5,0),new y(300,450,"1"),new y(600,450,"2"),new y(900,450,"3"),C.add.bitmapText(340,415,"handwriting","x "+C.onesCaptured,80),C.add.bitmapText(640,415,"handwriting","x "+C.twosCaptured,80),C.add.bitmapText(940,415,"handwriting","x "+C.threesCaptured,80),new p(460,600,"retry",function(){C.mode="random",C.room=1,C.onesCaptured=0,C.twosCaptured=0,C.threesCaptured=0,C.curtain.transition("main")},this),new p(760,605,"main-menu",function(){C.curtain.transition("menu")},this),C.soundButton.x=1220,C.curtain.raise()}},{key:"update",value:function(){this.newHighScore&&this.highScoreText.scale.set(1+.2*Math.sin(.005*C.time.now))}}]),t}(),C=new Phaser.Game(1280,720,Phaser.AUTO,"game");return C.state.add("load",f),C.state.add("menu",x),C.state.add("main",w),C.state.add("results",_),C.state.start("load"),C}();