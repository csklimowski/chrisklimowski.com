"use strict";var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var game=function(){var n={"1-1":{x:1440,y:270,layout:["           ","   00000   ","   00000   ","  N00100X  ","   00000   ","   00000   ","           "],unlocks:["1-2"]},"1-2":{x:1700,y:270,layout:["          ","          ","   0000   ","  N0110X  ","   0000   ","          ","          "],unlocks:["1-3"]},"1-3":{x:1950,y:340,layout:["           ","           ","  N01110X  ","   00000   ","           ","           "],unlocks:["1-4"]},"1-4":{x:2050,y:500,layout:["           ","           ","    101    ","   N000X   ","    101    ","           ","           "],unlocks:["1-5"]},"1-5":{x:2330,y:550,layout:["          ","    00    ","    01    ","    01    ","    01    ","   N01X   ","          "],unlocks:["X-1","2-1"]}},i={"X-1":{x:2330,y:890,layout:["           ","   10101   ","   01110   ","  N11111X  ","   01110   ","   10101   ","           "],unlocks:["X-2"]},"X-2":{x:2050,y:940,layout:["          ","          ","   0111   ","  N0111X  ","   0111   ","          ","          "],unlocks:["X-3"]},"X-3":{x:1950,y:1100,layout:["           ","           ","  N11111X  ","   00000   ","           ","           "],unlocks:["X-4"]},"X-4":{x:1700,y:1170,layout:["           ","           ","    111    ","   N001X   ","    111    ","           ","           "],unlocks:["X-5"]},"X-5":{x:1440,y:1170,layout:["          ","    01    ","    01    ","    01    ","    01    ","   N01X   ","          "],unlocks:[]}},o={"2-1":{x:2670,y:540,layout:["          ","          ","    00    ","  N0002X  ","    00    ","          ","          "],unlocks:["2-2"]},"2-2":{x:2930,y:500,layout:["          ","    00X   ","    02    ","    01    ","   N00    ","          "],unlocks:["2-3"]},"2-3":{x:3100,y:320,layout:["           ","     2     ","    010    ","   N000X   ","    010    ","     2     ","           "],unlocks:["2-4"]},"2-4":{x:3370,y:300,layout:["           ","    N X    ","   00000   ","   00 00   ","   02020   ","           "],unlocks:["2-5"]},"2-5":{x:3610,y:430,layout:["           ","    202    ","    000    ","   N000X   ","    000    ","    202    ","           "],unlocks:["Y-1","3-1"]}},s={"Y-1":{x:3610,y:1010,layout:["          ","          ","    00    ","  N0220X  ","    00    ","          ","          "],unlocks:["Y-2"]},"Y-2":{x:3370,y:1140,layout:["          ","    00X   ","    22    ","    11    ","   N00    ","          "],unlocks:["Y-3"]},"Y-3":{x:3100,y:1120,layout:["           ","     2     ","    010    ","   N121X   ","    010    ","     2     ","           "],unlocks:["Y-4"]},"Y-4":{x:2930,y:940,layout:["           ","    N X    ","   02020   ","   00 00   ","   02020   ","           "],unlocks:["Y-5"]},"Y-5":{x:2670,y:900,layout:["           ","    202   ","    000   ","   N000X   ","    000    ","    222  ","           "],unlocks:[]}},r={"3-1":{x:3960,y:430,layout:["           ","           ","    000    ","   N030X   ","    000    ","           ","           "],unlocks:["3-2"]},"3-2":{x:4185,y:290,layout:["          ","   N03X   ","    02    ","    01    ","    00    ","    00    ","          "],unlocks:["3-3"]},"3-3":{x:4510,y:265,layout:["          ","          ","   0030   ","  N0000X  ","   0300   ","          ","          "],unlocks:["3-4"]},"3-4":{x:4765,y:385,layout:["           ","   00300   ","   01010   ","  N00 00X  ","   01010   ","   00300   ","           "],unlocks:["3-5"]},"3-5":{x:4850,y:585,layout:["           ","           ","   10203   ","  N00000X  ","   10203   ","           ","           "],unlocks:["Z-1"]}},l={"Z-1":{x:4850,y:855,layout:["           ","           ","    030    ","   N000X   ","    030    ","           ","           "],unlocks:["Z-2"]},"Z-2":{x:4765,y:1055,layout:["          ","   N03X   ","    02    ","    01    ","    02    ","    03    ","          "],unlocks:["Z-3"]},"Z-3":{x:4510,y:1175,layout:["          ","          ","   3003   ","  N0000X  ","   3003   ","          ","          "],unlocks:["Z-4"]},"Z-4":{x:4185,y:1150,layout:["           ","   00100   ","   03030   ","  N00 00X  ","   03030   ","   00100   ","           "],unlocks:["Z-5"]},"Z-5":{x:3960,y:1010,layout:["           ","           ","   30201   ","  N00000X  ","   30201   ","           ","           "],unlocks:[]}},u=[{layout:["           ","    0a00b  ","  n0000    ","    0000X  ","           ","           "],info:{n:"TOUCH and RELEASE to move!",a:"You can't retrace your own path, but you can\nrevisit dots you've been to before.",b:"If you ever get stuck, you can press           to go\nback one step."}},{layout:["           ","   000  X  ","   0 0 000 "," N000a 000 ","   0   000 ","   b0000c0 ","           "],info:{a:"Revisiting dots that you've been to before builds\nup CHARGE.",b:"But if you visit a dot for the first time, your\ncharge goes away.",c:"So, to build up a charge of more than 1, you need\nto revisit multiple dots in a row."}},{layout:["           "," Na0b0     ","   00000   ","   00010X  ","   00000   ","           "],info:{a:"In each room, you need to CAPTURE all of the\nnumbers, then get to the exit.",b:"To capture a number, first build up a charge\nequal to it, then touch it."}}],d=(_inherits(t,Phaser.Image),_createClass(t,[{key:"update",value:function(){this.falling?(this.y=Math.min(0,this.y+2.5*R.time.elapsedMS),0<=this.y&&(R.state.start(this.newState),this.falling=!1,R.sfx.swoosh.play())):this.y+=2.5*R.time.elapsedMS}},{key:"raise",value:function(){this.y=R.height,this.angle=180}},{key:"transition",value:function(e){this.newState=e,this.falling=!0,this.y=-1e3,this.angle=0}}]),t);function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,R,R.width/2,0,"transition"));return R.stage.addChild(e),e.anchor.set(.5,0),e.falling=!1,e.newState="menu",e}var h=(_inherits(a,Phaser.Image),_createClass(a,[{key:"update",value:function(){var e=R.time.elapsedMS/1e3;this.y+=10*(this.targetY-this.y)*e,this.text.y=this.y+30,this.undoIcon.y=this.y+32}},{key:"appear",value:function(e){-1!==e.indexOf("    ")?this.undoIcon.alpha=1:this.undoIcon.alpha=0,this.text.text=e,this.targetY=450}},{key:"dismiss",value:function(){this.targetY=R.height}}]),a);function a(){_classCallCheck(this,a);var e=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,R,100,R.height,"info-box"));return R.stage.addChild(e),e.text=R.make.bitmapText(e.x+40,e.y+30,"handwriting","",70),R.stage.addChild(e.text),e.targetY=e.y,e.undoIcon=R.make.image(850,0,"undo"),R.stage.addChild(e.undoIcon),e}var c=(_inherits(m,Phaser.Sprite),_createClass(m,[{key:"unlockNext",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,i=R.levels[this.level].unlocks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;if(!R.levels[o].unlocked){R.levels[o].unlocked=!0;var s=R.levels[o].button;s.enabled=!0,s.overFrame=6,s.outFrame=11,s.animations.play("enable")}}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}if("1-5"===this.level){var r=!0,l=!1,u=void 0;try{for(var d,h=R.world1arrows[Symbol.iterator]();!(r=(d=h.next()).done);r=!0){var c=d.value;c.enabled||(c.enabled=!0,c.animations.play("enable"))}}catch(e){l=!0,u=e}finally{try{!r&&h.return&&h.return()}finally{if(l)throw u}}}if("2-5"===this.level){var m=!0,p=!1,g=void 0;try{for(var y,f=R.world2arrows[Symbol.iterator]();!(m=(y=f.next()).done);m=!0){var v=y.value;v.enabled||(v.enabled=!0,v.animations.play("enable"))}}catch(e){p=!0,g=e}finally{try{!m&&f.return&&f.return()}finally{if(p)throw g}}}"3-5"===this.level&&(R.world3arrow.enabled||(R.world3arrow.enabled=!0,R.world3arrow.animations.play("enable")))}}]),m);function m(e){_classCallCheck(this,m);var t=R.levels[e],a=_possibleConstructorReturn(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,R,t.x,t.y,"level-button"));return R.add.existing(a),a.anchor.set(.5,.7),a.level=e,a.inputEnabled=!0,t.completed?(a.enabled=!0,a.overFrame=2,a.outFrame=12):t.unlocked?(a.enabled=!0,a.overFrame=6,a.outFrame=11):(a.enabled=!1,a.overFrame=0,a.outFrame=0),a.frame=a.outFrame,a.events.onInputDown.add(function(){R.sfx.click.play(),this.frame=12,this.enabled&&(R.currentLevel=this.level,R.curtain.transition("main"))},a),a.animations.add("enable",[1,2,3,4,5,6,7,8,9,10,11],20,!1),a.animations.add("complete",[11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,9,8,7,6,5,4,3,2,1,12],20,!1),R.justCompleted===a.level&&(R.levels[a.level].completed=!0,a.overFrame=2,a.outFrame=12,a.events.onAnimationComplete.addOnce(a.unlockNext,a),a.animations.play("complete"),R.justCompleted=null),a}var p=(_inherits(g,Phaser.Sprite),g);function g(e,t,a,n,i){_classCallCheck(this,g);var o=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,R,e,t,a));return R.add.existing(o),o.anchor.set(.5),o.targetScale=1,o.inputEnabled=!0,o.onDown=n,o.onDownContext=i,n&&o.events.onInputDown.add(function(){R.sfx.click.play(),this.scale.set(1.1),this.onDown.call(i)},o),o.events.onInputUp.add(function(){this.scale.set(1),R.sfx.click.play()},o),o}var y=(_inherits(f,p),f);function f(e,t,a,n,i,o){_classCallCheck(this,f);var s=_possibleConstructorReturn(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e,t,"arrow"));return s.events.onInputDown.add(function(){R.sfx.click.play(),this.scale.set(1),this.enabled&&(R.menuX=this.menuX,R.menuY=this.menuY)},s),s.angle=i,s.menuX=a,s.menuY=n,(s.enabled=o)?s.frame=11:s.animations.add("enable",[0,1,2,3,4,5,6,7,8,9,10,11],40,!1),s}var e=(_inherits(v,Phaser.State),_createClass(v,[{key:"preload",value:function(){R.add.text(R.width/2,R.height/2,"Loading...",{font:"30px sans-serif",fill:"#ffffff",align:"center"}).anchor.set(.5),R.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,R.scale.windowConstraints.bottom="layout",R.load.spritesheet("level-button","img/menu/level-button.png",70,70),R.load.spritesheet("dot","img/game/dot.png",24,24),R.load.spritesheet("one","img/game/one.png",100,100),R.load.spritesheet("two","img/game/two.png",100,100),R.load.spritesheet("three","img/game/three.png",100,100),R.load.spritesheet("door","img/game/door.png",130,130),R.load.spritesheet("charge","img/game/charge.png",60,60),R.load.spritesheet("starburst","img/game/starburst.png",150,150),R.load.spritesheet("numburst","img/game/numburst.png",100,100),R.load.spritesheet("arrow","img/menu/level-arrow.png",110,110),R.load.spritesheet("hint-1","img/game/hint-1.png",250,150),R.load.spritesheet("hint-2","img/game/hint-2.png",150,150),R.load.spritesheet("volume","img/volume.png",76,72),R.load.image("logo","img/logo.png"),R.load.image("paper-texture","img/paper-texture.png"),R.load.image("transition","img/transition.png"),R.load.image("pencil","img/game/pencil.png"),R.load.image("pen","img/game/pen.png"),R.load.image("puzzles","img/menu/puzzles.png"),R.load.image("endless-dungeon","img/menu/endless-dungeon.png"),R.load.image("how-to-play","img/menu/how-to-play.png"),R.load.image("credits","img/menu/credits.png"),R.load.image("info-box","img/game/info-box.png"),R.load.image("question-mark","img/game/question-mark.png"),R.load.image("undo","img/game/undo.png"),R.load.image("exit","img/game/exit.png"),R.load.image("retry","img/menu/retry.png"),R.load.image("main-menu","img/menu/main-menu.png"),R.load.image("back","img/menu/back.png"),R.load.image("unlock-everything","img/menu/unlock-everything.png"),R.load.image("credits-page","img/menu/credits-page.png"),R.load.image("world1","img/menu/world1.png"),R.load.image("worldx","img/menu/worldx.png"),R.load.image("world2","img/menu/world2.png"),R.load.image("worldy","img/menu/worldy.png"),R.load.image("world3","img/menu/world3.png"),R.load.image("worldz","img/menu/worldz.png"),R.load.audio("pen","sfx/pen.ogg"),R.load.audio("click","sfx/click.ogg"),R.load.audio("music","sfx/music.ogg"),R.load.audio("door","sfx/door.ogg"),R.load.audio("charge1","sfx/charge1.ogg"),R.load.audio("charge2","sfx/charge2.ogg"),R.load.audio("charge3","sfx/charge3.ogg"),R.load.audio("charge4","sfx/charge4.ogg"),R.load.audio("charge5","sfx/charge5.ogg"),R.load.audio("swoosh","sfx/swoosh.ogg"),R.load.audio("whack","sfx/whack.ogg"),R.load.audio("oof","sfx/oof.ogg"),R.load.audio("whack","sfx/whack.ogg"),R.load.audio("aah","sfx/aah.ogg"),R.load.bitmapFont("handwriting","font/hw5.png","font/hw5.fnt")}},{key:"create",value:function(){if(R.sfx={music:R.add.audio("music",1,!0),pen:R.add.audio("pen",.8,!1),click:R.add.audio("click",1.2,!1),door:R.add.audio("door",1,!1),charge:[R.add.audio("charge1",1.5,!1),R.add.audio("charge2",1.5,!1),R.add.audio("charge3",1.5,!1),R.add.audio("charge4",1.5,!1),R.add.audio("charge5",1.5,!1)],swoosh:R.add.audio("swoosh",.15,!1),whack:R.add.audio("whack",.5,!1),oof:R.add.audio("oof",.15,!1),aah:R.add.audio("aah",.15,!1)},Cookies.get("dot_dungeons_data")){var e=Cookies.get("dot_dungeons_data");R.data=JSON.parse(e)}else R.data={levels:{"1-1":{unlocked:!0,completed:!1}},highScore:-1,soundSetting:0};for(var t in R.tutorial=u,R.levels=[],Object.assign(R.levels,n,i,o,s,r,l),R.levels)R.data.levels[t]||(R.data.levels[t]={unlocked:!1,completed:!1});for(var a in R.data.levels)R.levels[a].unlocked=R.data.levels[a].unlocked,R.levels[a].completed=R.data.levels[a].completed;R.soundButton=new p(1220,45,"volume",function(){0===this.data.soundSetting?(this.sound.mute=!0,this.sfx.music.stop(),this.data.soundSetting=1,this.soundButton.frame=1):1===this.data.soundSetting?(this.sound.mute=!1,this.data.soundSetting=2,this.soundButton.frame=2):2===this.data.soundSetting&&(this.sfx.music.play(),this.data.soundSetting=0,this.soundButton.frame=0),Cookies.set("dot_dungeons_data",JSON.stringify(R.data),{expires:365})},R),0===R.data.soundSetting?(R.sfx.music.play(),R.soundButton.frame=0):1===R.data.soundSetting?(R.sound.mute=!0,R.soundButton.frame=1):2===R.data.soundSetting&&(R.soundButton.frame=2),R.stage.addChild(R.soundButton),R.infoBox=new h,R.curtain=new d,R.overlay=R.make.tileSprite(0,0,7680,1440,"paper-texture"),R.stage.addChild(R.overlay),R.menuX=0,R.menuY=0,R.stage.backgroundColor=16777215,R.state.start("menu")}}]),v);function v(){return _classCallCheck(this,v),_possibleConstructorReturn(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}var x=(_inherits(b,Phaser.Sprite),b);function b(e,t,a){_classCallCheck(this,b);var n=void 0,i=void 0,o=void 0,s=void 0;"1"===a?(n=[0,1,2,3,4,5,6,7,7,7,7,7,7,7,7,7,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0],i=8,o=1,s="one"):"2"===a?(n=[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,9,10,11,12,13,14,15,16,15,14,13,12,11,10,9],i=17,o=2,s="two"):"3"===a&&(n=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],i=32,o=3,s="three");var r=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,R,e,t,s));return R.add.existing(r),r.anchor.set(.5),r.value=o,r.animations.add("idle",n,20,!0),r.animations.add("die",[i],0,!1),r.animations.play("idle"),r}var w=(_inherits(k,Phaser.Image),_createClass(k,[{key:"update",value:function(){if(this.hasInfo&&!this.everVisited&&(this.qm.rotation=Math.sin(R.time.now/200)/6),this.hadNumber){var e=R.time.elapsedMS/1e3;this.number.vy+=1e3*e,this.number.x+=this.number.vx*e,this.number.y+=this.number.vy*e,this.number.rotation+=2*e}}},{key:"markVisited",value:function(){this.hasInfo&&(this.qm.scale.set(.8),this.everVisited=!0),this.visited=!0,this.frame=1}},{key:"unmarkVisited",value:function(){this.visited=!1,this.frame=0}},{key:"defeatNumber",value:function(){R.sfx.whack.play();var e=Math.random();.8<e?R.sfx.aah.play():.6<e&&R.sfx.oof.play(),this.number.animations.play("die"),this.hasNumber=!1,this.hadNumber=!0,this.number.vx=(1200-this.x)/3,this.number.vy=-1e3}},{key:"reviveNumber",value:function(){this.number.animations.play("idle"),this.hasNumber=!0,this.hadNumber=!1,this.number.x=this.x,this.number.y=this.y,this.number.rotation=0}},{key:"unlock",value:function(){this.locked&&(this.door.animations.play("unlock"),R.sfx.door.play(),this.locked=!1),this.locked=!1}},{key:"lock",value:function(){this.locked||(this.door.frame=0,this.locked=!0)}}]),k);function k(e,t,a){_classCallCheck(this,k);var n=_possibleConstructorReturn(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,R,e,t,"dot"));if(R.add.existing(n),n.anchor.set(.5),n.visited=!1,"1"===a||"2"===a||"3"===a?(n.hasNumber=!0,n.hadNumber=!1,n.number=new x(e,t,a)):(n.hasNumber=!1,n.hadNumber=!1),"X"===a){var i=R.add.sprite(e,t,"door");i.animations.add("unlock",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],20,!1),i.anchor.set(.5),n.door=i,n.locked=!0}else n.locked=!1;if(-1!=="abcdn".indexOf(a)){var o=R.add.sprite(e,t,"question-mark");o.anchor.set(.5),n.qm=o,n.hasInfo=!0}else n.hasInfo=!1;return n}function _(e){return 150+100*e}function C(e){return 100+100*e}var X=(_inherits(N,Phaser.State),_createClass(N,[{key:"create",value:function(){for(var e in Cookies.set("dot_dungeons_data",JSON.stringify(R.data),{expires:365}),R.world.setBounds(0,0,7680,1440),this.graphics=R.add.graphics(0,0),this.buttons=R.add.group(),R.mode="puzzle",R.camera.x=R.menuX,R.camera.y=R.menuY,R.world1arrows=[new y(2400,420,2560,0,180,R.levels["2-1"].unlocked),new y(2200,630,1280,720,270,R.levels["X-1"].unlocked)],R.world2arrows=[new y(3700,290,3840,0,180,R.levels["3-1"].unlocked),new y(3450,580,2560,720,270,R.levels["Y-1"].unlocked)],R.world3arrow=new y(4970,450,3840,720,270,R.levels["Z-1"].unlocked),R.levels){var t=new c(e);R.levels[e].button=t}this.scenery=[R.add.image(350,50,"logo"),R.add.image(0,720,"credits-page"),R.add.image(1280,0,"world1"),new x(1890,90,"1"),R.add.image(1280,720,"worldx"),R.add.image(2560,0,"world2"),new x(3250,90,"2"),R.add.image(2560,720,"worldy"),R.add.image(3840,0,"world3"),new x(4250,90,"3"),R.add.image(3840,720,"worldz")],this.buttons=[new p(200,400,"endless-dungeon",function(){R.mode="random",R.room=1,R.onesCaptured=0,R.twosCaptured=0,R.threesCaptured=0,R.curtain.transition("main")},this),new p(1100,400,"puzzles",function(){R.menuX=1280},this),new p(650,400,"how-to-play",function(){R.mode="tutorial",R.room=0,R.curtain.transition("main")},this),new p(650,610,"credits",function(){R.menuY=720},this),new p(160,830,"back",function(){R.menuY=0},this),new y(1400,130,0,0,0,!0),new y(2450,850,1280,0,90,!0),new y(2680,350,1280,0,0,!0),new y(3720,850,2560,0,90,!0),new y(3960,580,2560,0,0,!0),new y(4650,850,3840,0,90,!0)],this.unlockButton=new p(950,1140,"unlock-everything",function(){for(var e in R.levels)R.data.levels[e].unlocked=!0,R.levels[e].unlocked=!0;R.curtain.transition("menu")},this),R.soundButton.x=1220,R.curtain.raise()}},{key:"update",value:function(){var e=R.time.elapsedMS/1e3;R.camera.x+=5*(R.menuX-R.camera.x)*e,R.camera.y+=5*(R.menuY-R.camera.y)*e;var t=this.graphics;for(var a in t.clear(),t.lineStyle(7,4473924),R.levels){var n=R.levels[a],i=!0,o=!1,s=void 0;try{for(var r,l=n.unlocks[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value,d=R.levels[u];d.unlocked&&(t.moveTo(n.button.x,n.button.y),t.lineTo(d.button.x,d.button.y))}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}}}}]),N);function N(){return _classCallCheck(this,N),_possibleConstructorReturn(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}var S=(_inherits(P,Phaser.Image),P);function P(e,t,a){if(_classCallCheck(this,P),a)var n=_possibleConstructorReturn(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,R,_(e),C(t),"pen"));else n=_possibleConstructorReturn(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,R,_(e),C(t),"pencil"));return R.add.existing(n),n.anchor.set(0,1),n.alpha=.5,n.charge=0,n.pos={x:e,y:t},n.next={x:e,y:t},_possibleConstructorReturn(n)}var O=(_inherits(Y,Phaser.Sprite),_createClass(Y,[{key:"loseCharge",value:function(){0<this.charge&&(this.charge=0,this.animations.play("disappear"),R.add.tween(this.number.scale).to({x:0,y:0},250).start())}},{key:"gainCharge",value:function(){0===this.charge?(this.animations.play("appear"),R.add.tween(this.number.scale).to({x:1,y:1},250).start()):this.animations.play("pulse"),this.charge++,5<this.charge&&(this.charge=5),this.number.frame=this.charge-1,R.sfx.charge[this.charge-1].play()}},{key:"setCharge",value:function(e){5<e&&(e=5),0===(this.charge=e)?(this.number.scale.set(0),this.frame=15):(this.number.scale.set(1),this.frame=5,this.number.frame=e-1)}},{key:"update",value:function(){var e=R.time.elapsedMS/1e3;this.rotation+=e,this.number.rotation=Math.sin(R.time.now/300)/8}}]),Y);function Y(){_classCallCheck(this,Y);var e=_possibleConstructorReturn(this,(Y.__proto__||Object.getPrototypeOf(Y)).call(this,R,R.width/2,80,"starburst",15));return R.add.existing(e),e.charge=0,e.number=R.add.sprite(e.x,e.y,"charge",5),e.numberCopy=R.add.sprite(e.x,e.y,"charge",5),e.number.anchor.set(.5),e.number.scale.set(0),e.numberCopy.anchor.set(.5),e.animations.add("appear",[14,13,12,11,10,9,8,7,6,5],30,!1),e.animations.add("disappear",[6,7,8,9,10,11,12,13,14,15],30,!1),e.animations.add("pulse",[0,1,2,3,4,5],20,!1),e.anchor.set(.5),e}var M=(_inherits(I,Phaser.State),_createClass(I,[{key:"create",value:function(){var e=void 0,t=R.add.bitmapText(15,0,"handwriting","",80);if("random"===R.mode)e=function(e){var t=Math.min(23,13+.5*e),a=Math.min(25,15+.5*e),n=Math.min(23,3+e),i=Math.min(25,5+e),o=void 0,s=void 0,r=0;do{r++,s=!1,o=[Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" "),Array(11).fill(" ")];var l=1+Math.floor(7*Math.random()),u=1+Math.floor(5*Math.random()),d=[],h=0,c=0,m=0;for(o[u][l]="N";;){d.push({x:l,y:u});for(var p=[],g=-1;g<2;g++)for(var y=-1;y<2;y++)if((0!==g||0!==y)&&0<l+g&&0<u+y&&l+g<8&&u+y<6){for(var f=!0,v=0;v<d.length-1;v++){if(d[v].x===l&&d[v].y===u&&d[v+1].x===l+g&&d[v+1].y===u+y){f=!1;break}if(d[v].x===l+g&&d[v].y===u+y&&d[v+1].x===l&&d[v+1].y===u){f=!1;break}}f&&p.push({x:g,y:y})}if(0===p.length){s=!0;break}var x=p[Math.floor(Math.random()*p.length)];if(l+=x.x," "===o[u+=x.y][l]){if(n<=m&&t<=h){o[u][l]="X";break}if(c<4?(o[u][l]=""+c,m+=c,3===c&&m++):o[u][l]="0",a<++h||i<m){s=!0;break}c=0}else c++}}while(s);return console.log("It took "+r+" attempts to generate this level."),{layout:o}}(R.room),t.text="Room "+R.room;else if("tutorial"===R.mode){if(2===R.room){var a=R.add.sprite(523,375,"hint-1");a.animations.add("swish",[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33],20,!0),a.animations.play("swish")}e=R.tutorial[R.room],t.text="How to Play"}else if("puzzle"===R.mode&&(e=R.levels[R.currentLevel],t.text=R.currentLevel,"2-2"===R.currentLevel)){var n=R.add.sprite(523,375,"hint-2");n.animations.add("swish",[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],20,!0),n.animations.play("swish")}var i=function(e){var t=[];t.remaining=0;for(var a=e.layout,n=0;n<a.length;n++){for(var i=[],o=0;o<a[n].length;o++){var s=a[n][o];if(" "===s)i.push(null);else{var r=new w(_(o),C(n),s);(r.hasNumber||r.hasInfo)&&t.remaining++,r.hasInfo&&(r.info=e.info[s]),i.push(r)}"N"!==s&&"n"!==s||(t.startX=o,t.startY=n,"n"===s&&t.remaining--),"X"===s&&(t.endX=o,t.endY=n)}t.push(i)}return t}(e);this.graphics=R.add.graphics(0,0),this.numburst=R.add.sprite(0,0,"numburst",6),this.numburst.animations.add("burst",[0,1,2,3,4,5,6],20,!1),this.numburst.anchor.set(.5),this.numburst.scale.set(1),this.ct=new O,this.pencil=new S(i.startX,i.startY,"random"===R.mode),this.fingerDown=!1,new p(1230,45,"exit",function(){R.infoBox.dismiss(),"random"===R.mode?R.curtain.transition("results"):R.curtain.transition("menu")},this),"random"!==R.mode&&new p(1150,45,"undo",this.undo,this),R.soundButton.x=1060,this.path=[{x:i.startX,y:i.startY,cleared:!1,visited:!0,finished:!1,charge:0}],this.exit=i[i.endY][i.endX],i[i.startY][i.startX].markVisited(),this.map=i,this.calculateValidMoves(),i[i.startY][i.startX].hasInfo&&R.infoBox.appear(i[i.startY][i.startX].info),this.justPaused=!1,R.input.activePointer.leftButton.onDown.add(this.movePencil,this),R.input.onDown.add(this.onTouch,this),R.input.onUp.add(this.movePencil,this),R.curtain.raise()}},{key:"paused",value:function(){this.justPaused=!0}},{key:"onTouch",value:function(){this.fingerDown=!0}},{key:"movePencil",value:function(){if(this.fingerDown&&(this.fingerDown=!1,"menu"!==R.state.current&&"results"!==R.state.current&&this.validMoves.length&&!(R.input.y<100)))if(this.justPaused)this.justPaused=!1;else{R.sfx.pen.play();var e=this.pencil,t=this.map;e.pos.x=e.next.x,e.pos.y=e.next.y,e.x=_(e.pos.x),e.y=C(e.pos.y);var a=t[e.pos.y][e.pos.x],n={x:e.pos.x,y:e.pos.y,cleared:!1,visited:!1,finished:!1};if(a.hasInfo?R.infoBox.appear(a.info):R.infoBox.dismiss(),!a.hasNumber||this.ct.charge===a.number.value&&("random"===R.mode&&(1===a.number.value?R.onesCaptured++:2===a.number.value?R.twosCaptured++:3===a.number.value&&R.threesCaptured++),t.remaining-=1,this.numburst.x=a.number.x,this.numburst.y=a.number.y,this.numburst.animations.play("burst"),a.defeatNumber(),n.cleared=!0),a.visited?0===R.room&&"tutorial"===R.mode||this.ct.gainCharge():(a.hasInfo&&!a.everVisited&&(t.remaining-=1),this.ct.loseCharge(),a.markVisited(),n.visited=!0),t.remaining<=0&&(this.exit.unlock(),n.finished=!0),n.charge=this.ct.charge,this.path.push(n),this.calculateValidMoves(),e.pos.x===t.endX&&e.pos.y===t.endY)if(this.validMoves=[],"random"===R.mode)R.room++,R.curtain.transition("main");else if("tutorial"===R.mode)R.room++,R.room>=R.tutorial.length?R.curtain.transition("menu"):R.curtain.transition("main");else{R.levels[R.currentLevel].completed||(R.justCompleted=R.currentLevel);var i=R.data.levels[R.currentLevel].completed=!0,o=!1,s=void 0;try{for(var r,l=R.levels[R.currentLevel].unlocks[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;R.data.levels[u].unlocked=!0}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}R.curtain.transition("menu")}}}},{key:"calculateValidMoves",value:function(){var e=this.pencil,t=this.path;this.validMoves=[];for(var a=-1;a<2;a++)for(var n=-1;n<2;n++)if((0!==a||0!==n)&&null!==this.map[e.pos.y+n][e.pos.x+a]&&!this.map[e.pos.y+n][e.pos.x+a].locked){for(var i=!0,o=0;o<this.path.length-1;o++){if(t[o].x===e.pos.x&&t[o].y===e.pos.y&&t[o+1].x===e.pos.x+a&&t[o+1].y===e.pos.y+n){i=!1;break}if(t[o].x===e.pos.x+a&&t[o].y===e.pos.y+n&&t[o+1].x===e.pos.x&&t[o+1].y===e.pos.y){i=!1;break}}i&&this.validMoves.push({x:a,y:n})}0===this.validMoves.length&&"random"===R.mode&&R.curtain.transition("results")}},{key:"update",value:function(){var e=this.pencil;if(this.fingerDown){var t=Number.POSITIVE_INFINITY,a=!0,n=!1,i=void 0;try{for(var o,s=this.validMoves[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var r=o.value,l=Phaser.Math.distance(R.input.activePointer.x,R.input.activePointer.y,_(e.pos.x+r.x),C(e.pos.y+r.y));l<t&&(e.next.x=e.pos.x+r.x,e.next.y=e.pos.y+r.y,t=l)}}catch(e){n=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}}var u=this.graphics,d=this.path;u.clear(),u.lineStyle(9,4473924),u.moveTo(_(d[0].x),C(d[0].y));for(var h=1;h<d.length;h++)u.lineTo(_(d[h].x),C(d[h].y));this.fingerDown&&100<R.input.activePointer.y&&(u.lineStyle(8,4473924,.15),u.lineTo(_(e.next.x),C(e.next.y)))}},{key:"undo",value:function(){if(!(this.path.length<=1)){var e=this.path.pop(),t=this.path[this.path.length-1],a=this.pencil;a.pos.x=t.x,a.pos.y=t.y,a.x=_(t.x),a.y=C(t.y),this.ct.setCharge(t.charge),e.cleared&&(this.map[e.y][e.x].reviveNumber(),this.map.remaining++,e.finished&&this.exit.lock()),e.visited&&this.map[e.y][e.x].unmarkVisited(),this.map[t.y][t.x].hasInfo?R.infoBox.appear(this.map[t.y][t.x].info):R.infoBox.dismiss(),this.calculateValidMoves()}}}]),I);function I(){return _classCallCheck(this,I),_possibleConstructorReturn(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}var T=(_inherits(j,Phaser.State),_createClass(j,[{key:"create",value:function(){var e=R.room-1;R.add.bitmapText(420,50,"handwriting","Rooms cleared: ",80),R.add.bitmapText(860,50,"handwriting",e+"",80).anchor.set(1,0),e>R.data.highScore?(R.data.highScore=e,this.highScoreText=R.add.bitmapText(640,180,"handwriting","Personal best!",80),this.highScoreText.anchor.set(.5,.5),this.newHighScore=!0):(R.add.bitmapText(420,125,"handwriting","Your best: ",80),R.add.bitmapText(860,125,"handwriting",R.data.highScore+"",80).anchor.set(1,0),this.newHighScore=!1),R.add.bitmapText(640,300,"handwriting","Numbers captured:",80).anchor.set(.5,0),new x(300,450,"1"),new x(600,450,"2"),new x(900,450,"3"),R.add.bitmapText(340,415,"handwriting","x "+R.onesCaptured,80),R.add.bitmapText(640,415,"handwriting","x "+R.twosCaptured,80),R.add.bitmapText(940,415,"handwriting","x "+R.threesCaptured,80),new p(460,600,"retry",function(){R.mode="random",R.room=1,R.onesCaptured=0,R.twosCaptured=0,R.threesCaptured=0,R.curtain.transition("main")},this),new p(760,605,"main-menu",function(){R.curtain.transition("menu")},this),R.soundButton.x=1220,R.curtain.raise()}},{key:"update",value:function(){this.newHighScore&&(this.highScoreText.scale.x,this.highScoreText.scale.set(1+.2*Math.sin(.005*R.time.now)))}}]),j);function j(){return _classCallCheck(this,j),_possibleConstructorReturn(this,(j.__proto__||Object.getPrototypeOf(j)).apply(this,arguments))}var R=new Phaser.Game(1280,720,Phaser.AUTO,"game");return R.state.add("load",e),R.state.add("menu",X),R.state.add("main",M),R.state.add("results",T),R.state.start("load"),R}();